# üèãÔ∏è‚Äç‚ôÇÔ∏è Sistema de Gesti√≥n de Gimnasios Gym Management System v3.0

> **La soluci√≥n integral m√°s avanzada para la gesti√≥n profesional de gimnasios y centros de fitness**

[![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)](https://python.org)
[![PyQt6](https://img.shields.io/badge/PyQt6-6.0+-green.svg)](https://www.riverbankcomputing.com/software/pyqt/)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-13+-blue.svg)](https://postgresql.org)
[![License](https://img.shields.io/badge/License-Proprietary-red.svg)]()

---

## üöÄ **¬øPor qu√© elegir Gym Management System?**

**Gym Management System** no es solo un software de gesti√≥n, es la **plataforma empresarial completa** que transformar√° tu gimnasio en un negocio altamente eficiente y rentable. Con m√°s de **50 caracter√≠sticas avanzadas** y una arquitectura robusta, Gym Management System est√° dise√±ado para gimnasios que buscan **excelencia operativa** y **crecimiento sostenible**.

### üí° **Valor Diferencial**
- ‚ö° **Rendimiento Superior**: B√∫squedas en < 100ms, inicio en < 3 segundos
- üéØ **ROI Comprobado**: Reduce costos operativos hasta un 40%
- üìä **Inteligencia de Negocio**: Dashboard ejecutivo con KPIs en tiempo real
- üîí **Seguridad Empresarial**: Auditor√≠a completa y respaldos autom√°ticos
- üåê **Integraci√≥n WhatsApp**: Comunicaci√≥n automatizada con socios
- üì± **Interfaz Moderna**: Dise√±o intuitivo con accesibilidad completa

---

## üéØ **Caracter√≠sticas Principales**

### üë• **Gesti√≥n Integral de Socios**
- **Base de Datos Centralizada**: Informaci√≥n completa de socios con historial detallado
- **Estados Inteligentes**: Activo, Inactivo, Moroso con indicadores visuales
- **Panel de Detalles Avanzado**: Vista 360¬∞ con historial de pagos, notas y m√©tricas
- **B√∫squeda Global Ultra-R√°pida**: Encuentra cualquier socio en milisegundos
- **Gesti√≥n de Documentos**: Almacenamiento seguro de contratos y documentaci√≥n

### üí≥ **Sistema de Pagos y Facturaci√≥n**
- **Flujo de Trabajo Guiado**: Proceso simplificado para registro de cuotas
- **Recibos Profesionales PDF**: Generaci√≥n autom√°tica con dise√±o corporativo
- **Control de Morosidad**: Alertas autom√°ticas y seguimiento de pagos pendientes
- **Reportes Financieros**: An√°lisis detallado de ingresos y tendencias
- **M√∫ltiples M√©todos de Pago**: Efectivo, transferencia, tarjeta con registro completo

### üí™ **Sistema Avanzado de Rutinas**
Un ecosistema completo para la creaci√≥n y gesti√≥n de planes de entrenamiento personalizados:

#### üéØ **Creaci√≥n de Rutinas Personalizadas**
- **Asignaci√≥n Individual**: Rutinas espec√≠ficas para cada socio
- **Planificaci√≥n Semanal**: Definici√≥n de d√≠as y ejercicios por jornada
- **Progresi√≥n Autom√°tica**: Seguimiento de evoluci√≥n y ajustes
- **Categorizaci√≥n Inteligente**: Organizaci√≥n por objetivos y niveles

#### üìã **Plantillas y Grupos de Ejercicios**
- **Biblioteca de Plantillas**: Rutinas predefinidas (Musculaci√≥n, Cardio, Funcional)
- **Gesti√≥n Colaborativa**: Acceso para due√±os y profesores
- **Reutilizaci√≥n Eficiente**: Aplicaci√≥n r√°pida de plantillas probadas
- **Personalizaci√≥n Avanzada**: Modificaci√≥n seg√∫n necesidades espec√≠ficas

#### üèãÔ∏è **Banco de Ejercicios Centralizado**
- **Base de Datos Completa**: Cat√°logo extenso de ejercicios por grupo muscular
- **Importaci√≥n/Exportaci√≥n Masiva**: Gesti√≥n mediante Excel para actualizaciones r√°pidas
- **Descripci√≥n Detallada**: Instrucciones y objetivos para cada ejercicio
- **B√∫squeda Inteligente**: Filtros por grupo muscular, objetivo y dificultad

#### üìÑ **Exportaci√≥n Profesional**
- **PDF Corporativo**: Rutinas con dise√±o profesional y branding
- **Excel Detallado**: Planillas completas para seguimiento
- **Impresi√≥n Optimizada**: Formato ideal para entrega a socios

### üßò **Gesti√≥n de Clases Grupales**
Sistema completo para la organizaci√≥n de actividades grupales:

#### üìÖ **Programaci√≥n de Clases**
- **Gesti√≥n de Horarios**: Creaci√≥n y edici√≥n de cronogramas semanales
- **Tipos de Clases**: Yoga, Funcional, Spinning, Pilates, etc.
- **Asignaci√≥n de Profesores**: Control de instructores por clase
- **Gesti√≥n de Cupos**: L√≠mites autom√°ticos y control de capacidad

#### üë• **Inscripci√≥n y Seguimiento**
- **Inscripci√≥n Simplificada**: Proceso r√°pido para socios
- **Control de Capacidad**: Alertas autom√°ticas de cupos completos
- **Lista de Espera**: Gesti√≥n autom√°tica de socios en espera
- **Historial de Asistencia**: Seguimiento detallado por socio y clase

#### üéØ **Ejercicios por Clase**
- **Rutinas Predefinidas**: Ejercicios recomendados por tipo de clase
- **Consistencia de Entrenamiento**: Mantenimiento de est√°ndares de calidad
- **Flexibilidad de Adaptaci√≥n**: Modificaciones seg√∫n nivel del grupo

### ‚è∞ **Sistema de Control de Horas Extra para Profesores**
Tecnolog√≠a avanzada para el seguimiento preciso del tiempo de trabajo:

#### üïê **Funcionamiento del Sistema**
El sistema compara autom√°ticamente las **sesiones de trabajo reales** con los **horarios establecidos** para cada profesor:

- **D√≠as Sin Horario**: Todo el tiempo trabajado se considera **horas extra**
- **D√≠as Con Horario**: 
  - ‚úÖ **Dentro del horario**: Se registra como horas normales
  - ‚ö†Ô∏è **Fuera del horario**: Se registra como horas extra
  - üìä **Parcialmente fuera**: Divisi√≥n autom√°tica entre normales y extra

#### üìä **C√°lculo Inteligente**
- **Horas Trabajadas**: Solo incluye tiempo dentro del horario establecido
- **Horas Extra**: Incluye todo el tiempo adicional (fuera de horario + d√≠as sin horario)
- **Precisi√≥n al Minuto**: C√°lculos exactos con redondeo inteligente
- **Reportes Detallados**: Desglose completo por d√≠a y per√≠odo

#### üíº **Ejemplo Pr√°ctico**
```
Profesor Juan - Horario: Lunes 9:00-17:00
‚Ä¢ Sesi√≥n Lunes 8:00-18:00 (10 horas)
  ‚Üí Horas Trabajadas: 8h (9:00-17:00)
  ‚Üí Horas Extra: 2h (8:00-9:00 + 17:00-18:00)

‚Ä¢ Sesi√≥n Martes 10:00-14:00 (4 horas - sin horario)
  ‚Üí Horas Trabajadas: 0h
  ‚Üí Horas Extra: 4h (todo el d√≠a)
```

### üë®‚Äçüè´ **Sistema de Sesiones de Trabajo**
Control completo del tiempo de trabajo de profesores con precisi√≥n empresarial:

#### üîê **Inicio y Cierre Autom√°tico**
- **Login Inteligente**: Inicio autom√°tico de sesi√≥n al ingresar al sistema
- **Detecci√≥n de Rol**: Activaci√≥n solo para profesores de musculaci√≥n
- **Sesiones Activas**: Detecci√≥n y continuaci√≥n de sesiones existentes
- **Cierre Autom√°tico**: Finalizaci√≥n al cerrar sesi√≥n o salir del sistema

#### ‚è±Ô∏è **Seguimiento en Tiempo Real**
- **Cron√≥metro Preciso**: Medici√≥n exacta hasta el segundo
- **Persistencia de Datos**: Mantenimiento de sesiones entre reinicios
- **M√∫ltiples Sesiones**: Soporte para varios profesores simult√°neos
- **Verificaci√≥n de Integridad**: Validaci√≥n autom√°tica de datos

#### üìà **Reportes y An√°lisis**
- **Historial Completo**: Registro detallado de todas las sesiones
- **M√©tricas por Profesor**: Estad√≠sticas individuales y comparativas
- **An√°lisis de Productividad**: Identificaci√≥n de patrones de trabajo
- **Exportaci√≥n de Datos**: Reportes para n√≥mina y administraci√≥n

### üì± **Sistema de Mensajer√≠a WhatsApp**
Integraci√≥n completa con WhatsApp Business API para comunicaci√≥n automatizada:

#### ‚öôÔ∏è **Configuraci√≥n Empresarial**
- **WhatsApp Business API**: Integraci√≥n oficial con credenciales seguras
- **App ID y Secret**: Configuraci√≥n de aplicaci√≥n empresarial
- **Access Token**: Autenticaci√≥n segura para env√≠o de mensajes
- **Webhook Configuration**: Recepci√≥n de mensajes entrantes

#### ü§ñ **Automatizaci√≥n Inteligente**
- **Confirmaci√≥n Autom√°tica**: Respuestas instant√°neas a mensajes recibidos
- **Recordatorios de Pago**: Notificaciones autom√°ticas para socios morosos
- **Mensajes de Bienvenida**: Comunicaci√≥n personalizada para nuevos socios
- **Respuestas Programadas**: Sistema de respuestas autom√°ticas configurables

#### üìä **Gesti√≥n y Monitoreo**
- **Log de Mensajes**: Registro completo de comunicaciones
- **Estado de Entrega**: Seguimiento de mensajes enviados y recibidos
- **Manejo de Errores**: Sistema robusto de recuperaci√≥n ante fallos
- **Configuraci√≥n Flexible**: Activaci√≥n/desactivaci√≥n de funciones espec√≠ficas

### üìä **Dashboard Ejecutivo y Reportes Avanzados**
Centro de inteligencia de negocio con m√©tricas empresariales en tiempo real:

#### üéØ **KPIs Estrat√©gicos**
- **Socios Activos**: Usuarios con acceso vigente al gimnasio
- **Ingresos del Mes**: Facturaci√≥n actualizada en tiempo real
- **ARPU (Average Revenue Per User)**: Ingreso promedio por socio activo
- **Tasa de Retenci√≥n**: Porcentaje de socios que renuevan mensualmente
- **Socios Morosos**: Identificaci√≥n autom√°tica de pagos pendientes
- **Nuevos Socios (30 d√≠as)**: Seguimiento de captaci√≥n mensual

#### üìà **An√°lisis de Inteligencia de Negocio**
- **Gr√°ficos Evolutivos**: Tendencias de facturaci√≥n y crecimiento
- **An√°lisis de Asistencia**: Patrones de uso y horarios pico
- **Capacidad de Clases**: Ocupaci√≥n promedio y optimizaci√≥n de recursos
- **Crecimiento de Ingresos**: Comparativas mensuales y proyecciones
- **Eficiencia Operacional**: M√©tricas de productividad del gimnasio

#### üö® **Sistema de Alertas Inteligentes**
- **Umbrales Configurables**: Alertas personalizadas por m√©trica
- **Notificaciones Cr√≠ticas**: Avisos autom√°ticos para situaciones importantes
- **Tendencias Negativas**: Detecci√≥n temprana de problemas operativos
- **Oportunidades de Mejora**: Identificaci√≥n de √°reas de crecimiento

#### üìÑ **Exportaci√≥n Profesional**
- **Reportes PDF**: Documentos ejecutivos con dise√±o corporativo
- **Excel Detallado**: Datos completos para an√°lisis avanzado
- **CSV para Integraci√≥n**: Compatibilidad con sistemas externos
- **Programaci√≥n Autom√°tica**: Generaci√≥n y env√≠o autom√°tico de reportes

### üîß **Herramientas de Mantenimiento y Administraci√≥n**

#### üè• **Diagn√≥sticos del Sistema**
- **Monitoreo en Tiempo Real**: CPU, memoria, disco y base de datos
- **An√°lisis de Rendimiento**: Identificaci√≥n de cuellos de botella
- **Alertas de Salud**: Notificaciones autom√°ticas de problemas
- **Recomendaciones Inteligentes**: Sugerencias de optimizaci√≥n

#### üóÑÔ∏è **Gesti√≥n de Base de Datos**
- **Respaldos Autom√°ticos**: Copias de seguridad programadas
- **Optimizaci√≥n Autom√°tica**: Mantenimiento preventivo de tablas
- **Verificaci√≥n de Integridad**: Validaci√≥n autom√°tica de datos
- **Herramientas de Recuperaci√≥n**: Restauraci√≥n r√°pida ante fallos

#### üîç **Auditor√≠a y Seguridad**
- **Log Completo de Actividades**: Registro detallado de todas las operaciones
- **Seguimiento de Usuarios**: Historial de acciones por usuario
- **An√°lisis de Patrones**: Detecci√≥n de actividades inusuales
- **Reportes de Seguridad**: Documentaci√≥n para auditor√≠as

### üé® **Personalizaci√≥n y Accesibilidad**

#### üñåÔ∏è **Branding Corporativo**
- **Personalizaci√≥n Visual**: Colores, logos y tipograf√≠as corporativas
- **Temas Din√°micos**: Modo claro y oscuro con transiciones suaves
- **Dise√±o Responsive**: Adaptaci√≥n autom√°tica a diferentes resoluciones
- **Elementos Personalizables**: Iconos, botones y componentes visuales

#### ‚ôø **Accesibilidad Universal**
- **Soporte para Lectores de Pantalla**: Compatibilidad NVDA y JAWS
- **Navegaci√≥n por Teclado**: Acceso completo sin mouse
- **Alto Contraste**: Modos visuales para usuarios con discapacidad visual
- **Tama√±os de Fuente Ajustables**: Escalado din√°mico de texto
- **Alertas Sonoras**: Notificaciones auditivas configurables

---

## üõ†Ô∏è **Arquitectura T√©cnica**

### üíª **Stack Tecnol√≥gico**
- **Frontend**: PyQt6 con dise√±o modular y componentes reutilizables
- **Backend**: Python 3.8+ con arquitectura orientada a objetos
- **Base de Datos**: PostgreSQL 13+ con optimizaciones empresariales
- **Reportes**: ReportLab para PDFs profesionales
- **Gr√°ficos**: Matplotlib con visualizaciones interactivas
- **An√°lisis**: Pandas para procesamiento de datos masivos
- **Concurrencia**: Threading para operaciones as√≠ncronas

### üèóÔ∏è **Arquitectura del Sistema**
```
gym-management-system/
‚îú‚îÄ‚îÄ main.py                 # Aplicaci√≥n principal y punto de entrada
‚îú‚îÄ‚îÄ database.py            # Gesti√≥n de base de datos y ORM personalizado
‚îú‚îÄ‚îÄ models.py              # Modelos de datos y entidades de negocio
‚îú‚îÄ‚îÄ widgets/               # Componentes de interfaz modular
‚îÇ   ‚îú‚îÄ‚îÄ users_tab_widget.py           # Gesti√≥n de socios
‚îÇ   ‚îú‚îÄ‚îÄ payments_tab_widget.py        # Sistema de pagos
‚îÇ   ‚îú‚îÄ‚îÄ professors_tab_widget.py      # Gesti√≥n de profesores
‚îÇ   ‚îú‚îÄ‚îÄ routines_tab_widget.py        # Sistema de rutinas
‚îÇ   ‚îú‚îÄ‚îÄ classes_tab_widget.py         # Clases grupales
‚îÇ   ‚îú‚îÄ‚îÄ reports_tab_widget.py         # Dashboard y reportes
‚îÇ   ‚îú‚îÄ‚îÄ whatsapp_config_widget.py     # Configuraci√≥n WhatsApp
‚îÇ   ‚îú‚îÄ‚îÄ system_diagnostics_widget.py  # Diagn√≥sticos del sistema
‚îÇ   ‚îî‚îÄ‚îÄ audit_dashboard_widget.py     # Auditor√≠a y seguridad
‚îú‚îÄ‚îÄ managers/              # Gestores de l√≥gica de negocio
‚îÇ   ‚îú‚îÄ‚îÄ whatsapp_manager.py          # Integraci√≥n WhatsApp
‚îÇ   ‚îú‚îÄ‚îÄ export_manager.py            # Exportaci√≥n de datos
‚îÇ   ‚îú‚îÄ‚îÄ payment_manager.py           # Procesamiento de pagos
‚îÇ   ‚îî‚îÄ‚îÄ search_manager.py            # Motor de b√∫squeda
‚îú‚îÄ‚îÄ utils_modules/         # M√≥dulos de utilidades
‚îÇ   ‚îú‚îÄ‚îÄ accessibility_manager.py     # Gesti√≥n de accesibilidad
‚îÇ   ‚îú‚îÄ‚îÄ audit_logger.py             # Sistema de auditor√≠a
‚îÇ   ‚îî‚îÄ‚îÄ keyboard_manager.py         # Navegaci√≥n por teclado
‚îî‚îÄ‚îÄ styles/               # Hojas de estilo din√°micas
    ‚îú‚îÄ‚îÄ light_theme.qss              # Tema claro
    ‚îî‚îÄ‚îÄ dark_theme.qss               # Tema oscuro
```

---

## üîß Configuraci√≥n de Base de Datos (Local)

- La app de escritorio ahora viene preparada para usar una base local por defecto.
- Valores por defecto (editables): `host=localhost`, `port=5432`, `database=gimnasio`, `user=postgres`, `sslmode=prefer`.
- Abre `cdbconfig.py` y utiliza el bot√≥n `Probar conexi√≥n local` para validar r√°pidamente la conexi√≥n a tu PostgreSQL local. Esta prueba ahora est√° centralizada y usa `DatabaseManager.test_connection()`.
- La contrase√±a se guarda de forma segura en el almac√©n del sistema (keyring). Si no hay keyring disponible, puedes optar por guardarla en `config/config.json` como respaldo.
- Importante: Si tienes variables de entorno `DB_*` definidas, tienen prioridad sobre `config.json`. Elim√≠nalas o aj√∫stalas si quieres forzar los valores locales.

### Ejemplo de conexi√≥n local

1) Instala PostgreSQL localmente y crea la base `gimnasio`.
2) Ejecuta `python cdbconfig.py`, ingresa los par√°metros locales y presiona `Probar conexi√≥n local`.
3) Presiona `Guardar` para persistir los cambios en `config/config.json` y almacenar la contrase√±a en el keyring.

---

## üîß Configuraci√≥n de Base de Datos (Railway)

- Edita la configuraci√≥n desde el escritorio con `cdbconfig.py` (men√∫: Configuraci√≥n de Base de Datos). Las pruebas de conexi√≥n utilizan la API central `DatabaseManager.test_connection()` para mantener un comportamiento consistente.
- Campos configurables: `host`, `port`, `database`, `user`, `password`, `sslmode`, `connect_timeout`, `application_name`.
- Usa los datos provistos por Railway Postgres:
  - `host`: host de Railway (ej. `containers-us-west-xxx.railway.app`)
  - `port`: puerto asignado por Railway
  - `database`: com√∫nmente `railway`
  - `user`: com√∫nmente `postgres`
  - `sslmode`: recomienda `require`
- La configuraci√≥n se guarda en `config/config.json` y la contrase√±a en el almac√©n seguro del sistema (keyring). Opcionalmente, puedes guardar la contrase√±a en `config.json` como respaldo.
- Nota: Las variables de entorno `DB_HOST`, `DB_PORT`, `DB_NAME`, `DB_USER`, `DB_PASSWORD`, `DB_SSLMODE`, `DB_CONNECT_TIMEOUT`, `DB_APPLICATION_NAME` tienen prioridad sobre `config.json`.

### API de conexi√≥n centralizada

- M√©todo: `DatabaseManager.test_connection(params: dict | None) -> bool`
- Comportamiento:
  - Si `params` es `None`, intenta resolver par√°metros desde entorno (`DB_*`) y defaults.
  - Si se proveen par√°metros, se mapean a `psycopg2.connect` (`host`, `port`, `database`->`dbname`, `user`, `password`, `sslmode`, `connect_timeout`, `application_name`, `options`).
  - Ejecuta `SELECT 1` y cierra la conexi√≥n. Devuelve `True/False`.
- Beneficios: una √∫nica implementaci√≥n para pruebas, timeouts consistentes y soporte de `options` para timeouts de sesi√≥n.

### Comando de inicio web sugerido (Railway)

- `python -m uvicorn webapp.server:app --host 0.0.0.0 --port ${PORT}`
- Asegura que las variables de entorno de Railway Postgres est√©n disponibles (map√©alas a las variables `DB_*` si cambian de nombre).

### üîí **Seguridad y Confiabilidad**
- **Encriptaci√≥n de Datos**: Protecci√≥n de informaci√≥n sensible
- **Validaci√≥n de Entrada**: Prevenci√≥n de inyecci√≥n SQL y XSS
- **Gesti√≥n de Sesiones**: Control seguro de acceso de usuarios
- **Respaldos Autom√°ticos**: Copias de seguridad programadas
- **Log de Auditor√≠a**: Registro completo de actividades
- **Recuperaci√≥n ante Fallos**: Mecanismos de recuperaci√≥n autom√°tica

---

## üìà **M√©tricas de Rendimiento**

### ‚ö° **Benchmarks Comprobados**
- **Tiempo de Inicio**: < 3 segundos en hardware est√°ndar
- **B√∫squeda Global**: < 100ms para bases de datos de hasta 10,000 registros
- **Generaci√≥n de Reportes**: < 5 segundos para reportes mensuales completos
- **Uso de Memoria**: < 150MB en operaci√≥n normal
- **Tiempo de Respuesta**: < 50ms para operaciones CRUD b√°sicas
- **Capacidad de Usuarios**: Soporte para hasta 5,000 socios activos

### üñ•Ô∏è **Compatibilidad**
- **Windows**: 10/11 (x64)
- **macOS**: 10.15+ (Intel/Apple Silicon)
- **Linux**: Ubuntu 20.04+, CentOS 8+, Debian 11+
- **Memoria RAM**: M√≠nimo 4GB, Recomendado 8GB
- **Espacio en Disco**: 2GB para instalaci√≥n + datos
- **Procesador**: Intel i3/AMD Ryzen 3 o superior

---

## üöÄ **Instalaci√≥n y Configuraci√≥n**

### üìã **Requisitos Previos**
```bash
# Python 3.8 o superior
python --version

# PostgreSQL 13 o superior
psql --version

# Git para clonaci√≥n del repositorio
git --version
```

### ‚öôÔ∏è **Instalaci√≥n R√°pida**
```bash
# 1. Clonar el repositorio
git clone https://github.com/tu-usuario/gym-management-system.git
cd gym-management-system

# 2. Crear entorno virtual
python -m venv venv
source venv/bin/activate  # Linux/Mac
# o
venv\Scripts\activate     # Windows

# 3. Instalar dependencias
pip install -r requirements.txt

# 4. Configurar base de datos
python initialize_database.py

# 5. Ejecutar la aplicaci√≥n
python main.py
```

### üîÅ Replicaci√≥n l√≥gica PostgreSQL (bidireccional)

La aplicaci√≥n no incluye ni inicia motores externos de replicaci√≥n. La sincronizaci√≥n entre la base local y la base en Railway se realiza mediante replicaci√≥n l√≥gica nativa de PostgreSQL (publications/subscriptions), administrada exclusivamente desde los servidores de base de datos.

Gu√≠a de alto nivel:
- Crear una `PUBLICATION` en la base origen para las tablas a replicar.
- Crear una `SUBSCRIPTION` en la base destino apuntando a la publicaci√≥n, con un rol y conexi√≥n seguros.
- Ajustar filtros de tablas seg√∫n necesidad (excluir temporales/auditor√≠a si corresponde).

Ejemplo m√≠nimo (adaptar a tu esquema y credenciales):

```sql
-- En la base origen (Railway o local, seg√∫n dise√±o):
CREATE PUBLICATION gym_pub FOR ALL TABLES;

-- En la base destino:
CREATE SUBSCRIPTION gym_sub
  CONNECTION 'host=<HOST> port=<PORT> dbname=<DB> user=<USER> password=<PASS> sslmode=require'
  PUBLICATION gym_pub;
```

Verificaci√≥n r√°pida (PostgreSQL):
- Consultar `pg_stat_subscription` en la base destino para ver el estado de la suscripci√≥n.
- Consultar `pg_publication`/`pg_publication_tables` en la base origen para revisar la publicaci√≥n.
- Probar inserciones/actualizaciones/eliminaciones y confirmar reflectancia en la contraparte.

Automatizaci√≥n con script:
- Ejecuta `python scripts/setup_logical_replication.py` para crear/asegurar la `PUBLICATION` remota (`gym_pub`) y la `SUBSCRIPTION` local (`gym_sub`).
- El script lee `config/config.json` y admite variables de entorno: `PGREMOTE_DSN`, `PGREMOTE_PASSWORD`, `PGREMOTE_USER`, `PGLOCAL_DSN`, `PGLOCAL_PASSWORD`.
- Si no hay contrase√±a remota en entorno/DSN, intenta obtenerla de `keyring` (Windows Credential Manager) bajo el servicio `GymMS_DB`.
- Tras ejecutar, verifica estado con: `SELECT subname, sync_state, apply_lag FROM pg_stat_subscription;` en la base local.

Limpieza de artefactos antiguos:
- Si existen objetos heredados `sym_%` de motores previos de replicaci√≥n, elim√≠nalos manualmente (DROP) o con tus propios scripts; este proyecto no incluye `scripts/cleanup_symmetricds.sql`.

### üîß **Configuraci√≥n Inicial**
1. **Base de Datos**: Configurar conexi√≥n PostgreSQL en `config.py`
2. **WhatsApp Business**: Obtener credenciales de Meta Business
3. **Personalizaci√≥n**: Configurar branding y temas corporativos
4. **Usuarios**: Crear cuenta de administrador inicial
5. **Respaldos**: Configurar programaci√≥n de copias de seguridad

---

## üÜï **Novedades de la Versi√≥n 3.0**

### üéØ **Nuevas Caracter√≠sticas**
- ‚ú® **Sistema de Horas Extra**: Control autom√°tico de tiempo de trabajo
- üì± **Integraci√≥n WhatsApp**: Comunicaci√≥n automatizada con socios
- üèãÔ∏è **Rutinas Avanzadas**: Sistema completo de entrenamiento personalizado
- üßò **Clases Grupales**: Gesti√≥n integral de actividades grupales
- üìä **Dashboard Ejecutivo**: KPIs y m√©tricas empresariales en tiempo real
- üîç **Auditor√≠a Completa**: Sistema de seguimiento y seguridad avanzado

### üöÄ **Mejoras de Rendimiento**
- ‚ö° **50% m√°s r√°pido** en b√∫squedas globales
- üíæ **30% menos uso de memoria** en operaciones masivas
- üîÑ **Carga as√≠ncrona** para mejor experiencia de usuario
- üìà **Optimizaci√≥n de consultas** SQL para reportes complejos

### üé® **Experiencia de Usuario**
- üñåÔ∏è **Interfaz renovada** con dise√±o moderno y profesional
- ‚ôø **Accesibilidad completa** para usuarios con discapacidades
- üåô **Modo oscuro** con transiciones suaves
- ‚å®Ô∏è **Navegaci√≥n por teclado** mejorada

---

## üíº **Casos de Uso Empresariales**

### üè¢ **Gimnasios Boutique (50-200 socios)**
- Gesti√≥n personalizada de socios VIP
- Rutinas individualizadas por entrenador personal
- Comunicaci√≥n directa v√≠a WhatsApp
- Reportes ejecutivos para toma de decisiones

### üè≠ **Cadenas de Gimnasios (200-1000 socios)**
- Dashboard centralizado multi-sucursal
- An√°lisis comparativo de rendimiento
- Automatizaci√≥n de procesos operativos
- Integraci√≥n con sistemas de n√≥mina

### üåü **Centros de Alto Rendimiento (1000+ socios)**
- M√©tricas avanzadas de retenci√≥n y crecimiento
- Sistema de auditor√≠a para compliance
- Reportes autom√°ticos para inversores
- Escalabilidad empresarial comprobada

---

## üéØ **ROI y Beneficios Empresariales**

### üí∞ **Retorno de Inversi√≥n**
- **Reducci√≥n de Costos Operativos**: Hasta 40% menos tiempo en tareas administrativas
- **Aumento de Retenci√≥n**: Mejora del 25% en renovaci√≥n de socios
- **Optimizaci√≥n de Recursos**: 30% mejor utilizaci√≥n de profesores y espacios
- **Reducci√≥n de Errores**: 95% menos errores en facturaci√≥n y pagos

### üìä **M√©tricas de √âxito**
- **Tiempo de Recuperaci√≥n**: 3-6 meses t√≠picamente
- **Ahorro Anual**: $15,000 - $50,000 USD seg√∫n tama√±o del gimnasio
- **Productividad**: 60% menos tiempo en reportes manuales
- **Satisfacci√≥n**: 90%+ de satisfacci√≥n de usuarios finales

---

## ü§ù **Soporte y Servicios**

### üìû **Soporte T√©cnico**
- **Instalaci√≥n Guiada**: Configuraci√≥n completa incluida
- **Capacitaci√≥n del Personal**: Entrenamiento presencial o virtual
- **Soporte 24/7**: Asistencia t√©cnica continua
- **Actualizaciones Autom√°ticas**: Nuevas caracter√≠sticas sin costo adicional

### üéì **Servicios Profesionales**
- **Migraci√≥n de Datos**: Importaci√≥n desde sistemas existentes
- **Personalizaci√≥n Avanzada**: Desarrollo de caracter√≠sticas espec√≠ficas
- **Integraci√≥n con Terceros**: Conexi√≥n con sistemas de pago, contabilidad, etc.
- **Consultor√≠a de Procesos**: Optimizaci√≥n de flujos de trabajo

---

## üìû **Contacto y Ventas**

### üè¢ **Informaci√≥n Comercial**
- **Email**: piedrabuena.mateo03@gmail.com
- **Tel√©fono**: +54 343 4473599
- **WhatsApp Business**: +54 9 343 4473599
- **Sitio Web**: www.gym-management-system.com

### üí¨ **Solicitar Demo**
¬øQuieres ver Gym Management System en acci√≥n? Agenda una demostraci√≥n personalizada:
- **Demo Online**: 30 minutos de presentaci√≥n interactiva
- **Prueba Gratuita**: 14 d√≠as de acceso completo
- **Visita Presencial**: Demostraci√≥n en tu gimnasio
- **An√°lisis de Necesidades**: Consultor√≠a gratuita de procesos

---

## üìÑ **Licencia y T√©rminos**

Este software es **propiedad exclusiva** de Gym Management System. Todos los derechos reservados.
Para informaci√≥n sobre licenciamiento empresarial, contactar al equipo comercial.

---

<div align="center">

**üèãÔ∏è‚Äç‚ôÇÔ∏è Gym Management System - Transformando Gimnasios en Empresas de √âxito üèãÔ∏è‚Äç‚ôÄÔ∏è**

</div>



python build_installer.py --mode onefile
### üåê **Acceso Web P√∫blico (Railway recomendado)**
- El servidor web se inicia autom√°ticamente en `main.py` y en el lanzador web `GymMSW.py` usando `start_web_server`.
- La URL p√∫blica ya no depende de LocalTunnel: se resuelve con `get_webapp_base_url()` (por defecto `https://gym-ms-zrk.up.railway.app`).
- `start_public_tunnel` act√∫a como un no-op y retorna la URL p√∫blica configurada.
- La URL p√∫blica se abre autom√°ticamente en el navegador en `main.py` y se muestra en la ventana/tray de `GymMSW.py`.

#### üîß Configuraci√≥n de URL P√∫blica
- Archivo `config/config.json` (preferido):
```
{
  "host": "localhost",
  "port": 5432,
  "database": "gimnasio",
  "user": "postgres",
  "sslmode": "prefer",
  "connect_timeout": 10,
  "application_name": "gym_management_system",
  "webapp_base_url": "https://gym-ms-zrk.up.railway.app",
  "public_tunnel": {
    "subdomain": "gym-ms-zrk",
    "enabled": false
  }
}
```
- Variables de entorno:
  - `WEBAPP_BASE_URL=https://gym-ms-zrk.up.railway.app`
  - `PUBLIC_TUNNEL_ENABLED=0` (recomendado en Railway)

#### üöÄ Arranque y Uso
- Desarrollo (aplicaci√≥n completa): `python main.py`
  - Inicia servidor web y resuelve URL p√∫blica con `get_webapp_base_url()`.
  - Abre el navegador en la URL p√∫blica detectada (p. ej., `https://gym-ms-zrk.up.railway.app/`).
- Si `public_tunnel.enabled` es `false` o `PUBLIC_TUNNEL_ENABLED=0`, se omiten intentos de t√∫nel y se usa la URL de Railway.
- Desarrollo (solo web launcher): `python GymMSW.py`
  - Inicia servidor web y muestra ventana/tray con enlaces local y p√∫blico.
  - Si el t√∫nel p√∫blico est√° deshabilitado, el enlace p√∫blico se omite.

#### üîê Contrase√±as y Recordatorios
- En la configuraci√≥n Railway no se requiere contrase√±a de t√∫nel.
- El endpoint `GET /tunnel/password` queda deshabilitado y retorna `{ password: null, ok: false }`.
  - Nota: navegadores est√°ndar seguir√°n mostrando la p√°gina; comparte la contrase√±a con tus visitantes.

### üõ†Ô∏è **Construcci√≥n de Ejecutables**
- Ejecutable standalone: `python build_installer.py --mode onefile`
- Carpeta de salida: `dist/` (contiene ejecutables y recursos).
- Ejecutables generados:
  - `GymMSW.exe`: lanzador web con indicador y bandeja del sistema.
  - `Gym_Management_System.exe`: aplicaci√≥n principal empaquetada.
  - `cdbconfig.exe`: editor de configuraci√≥n de base de datos.

#### ‚úÖ Verificaciones previas al build
- Crea `logs/` en el proyecto si no existe para evitar `FileNotFoundError` en runtime.
- Muestra versiones detectadas de dependencias clave (`fastapi`, `uvicorn`, `starlette`, `psycopg2`) y las compara con `requirements.txt`.
- Genera bootstrap remoto desde variables de entorno si est√°n definidas.

#### üß© psycopg2 y dependencias nativas
- Detecta la carpeta `psycopg2.libs` y la incluye en el build (`libpq`, `ssl`, etc.).
- Si `psycopg2` no est√° instalado, intenta instalar `psycopg2-binary` autom√°ticamente antes del empaquetado.
- En `dist/lib/` deben existir `psycopg2/` y `psycopg2.libs/` tras el build.

#### üîÅ Reproducibilidad del build
- Usa entorno virtual: `python -m venv venv && venv\Scripts\activate`.
- Instala dependencias: `pip install -r requirements.txt`.
- Ejecuta: `python build_installer.py` (opcional `--msi` en Windows para instalador MSI).
- No se requiere servidor de t√∫nel ni procesos adicionales; el build es determinista.

#### üìù Notas de logging
- El sistema escribe en `logs/` (ra√≠z del proyecto). Si el directorio no existe, se crea autom√°ticamente en tiempo de ejecuci√≥n.
- Se reforz√≥ el manejo defensivo en `utils_modules/users_loader.py` para crear `logs/` al escribir `logs/cache_metrics.json`.
- La configuraci√≥n de logging se inicializa temprano en `main.py` v√≠a `logger_config.setup_logging()`.

### üé® **Estilos Din√°micos y Branding**
- Los estilos `styles/style.qss` se aplican y se enriquecen con CSS din√°mico.
- Se utilizan variables de branding (colores, tipograf√≠as, logos) desde base de datos o configuraci√≥n.
- Widgets relevantes: `branding_customization_widget.py`, `accessibility_widget.py`, `chart_widget.py`.

### üßπ **Cierre Seguro del T√∫nel**
- Al salir, se intenta terminar procesos del t√∫nel p√∫blico (`terminate_tunnel_processes`) y cualquier `ssh.exe` residual (`terminate_ssh_processes`).
- Existe un cierre defensivo adicional reutilizado desde `main.py`.

## üîÑ Sincronizaci√≥n bidireccional (Outbox + Replicaci√≥n)
- Replicaci√≥n l√≥gica Postgres (remoto ‚Üí local) ya automatizada por el sistema.
- Outbox con triggers (local ‚Üí remoto) capturando cambios en todas las tablas listadas en `config/sync_tables.json`.

### ‚è±Ô∏è Asegurar `updated_at` para reconciliaci√≥n por timestamp
- Las rutinas de reconciliaci√≥n utilizan la columna `updated_at` para decidir qu√© cambio es m√°s reciente.
 - Por defecto, la tabla `usuarios` ya trae columna, √≠ndice y trigger `BEFORE INSERT OR UPDATE` que actualiza `updated_at = NOW()`.
- Para aplicar esta pol√≠tica a todas las tablas incluidas en `config/sync_tables.json`, ejecuta:

```powershell
python scripts/ensure_updated_at_triggers.py --apply-local --apply-remote
```

- El script:
  - Crea/asegura la funci√≥n `public.set_updated_at()`.
  - A√±ade la columna `updated_at TIMESTAMPTZ DEFAULT NOW()` si falta y la inicializa donde est√© en `NULL`.
  - Crea el √≠ndice `idx_<tabla>_updated_at` si falta.
   - Crea el trigger `trg_<tabla>_set_updated_at` (`BEFORE INSERT OR UPDATE`) que asigna `NEW.updated_at = NOW()`.
  - Aplica en LOCAL y REMOTO (puedes limitar con `--apply-local` o `--apply-remote`).

- Opciones:
  - `--dry-run`: imprime acciones sin aplicar cambios.
  - `--schema public`: esquema objetivo (por defecto `public`).
  - `--tables usuarios pagos`: limitar a tablas espec√≠ficas.

- Sugerido tras asegurar `updated_at`:

```powershell
python scripts/reconcile_local_remote_once.py --dry-run
python scripts/reconcile_remote_to_local_once.py --force
```

#### Ejecuci√≥n autom√°tica de `updated_at`
- En nuevas instalaciones y arranques, la app asegura `updated_at` sin intervenci√≥n:
  - Primer arranque (escritorio): `scripts/auto_setup.py` invoca el aseguramiento tras crear la base local y tras configurar la replicaci√≥n, aplic√°ndolo en local y remoto si hay credenciales.
  - Prerrequisitos del cliente: `utils_modules/prerequisites.ensure_prerequisites` intenta aplicar en LOCAL y REMOTO de forma idempotente.
  - Arranque del servidor (FastAPI): se intenta aplicar en REMOTO sin bloquear el inicio.
- Para REMOTO, provee credenciales en `config/config.json` o variables como `DATABASE_URL_REMOTE`, `DB_REMOTE_PASSWORD`. Para LOCAL, usa `DATABASE_URL_LOCAL` o los valores por defecto.
- Este proceso es seguro e idempotente: solo crea la columna, √≠ndice y trigger cuando faltan.

#### Reconciliaci√≥n programada (Windows)
- Se crean dos tareas diarias para mantener sincron√≠a autom√°tica:
  - `GymMS_Reconcile_LocalToRemote` a las `03:10` ejecuta `scripts/run_reconcile_scheduled_hidden.vbs` ‚Üí `scripts/run_reconcile_scheduled.ps1` ‚Üí `scripts/reconcile_local_remote_once.py`.
  - `GymMS_Reconcile_RemoteToLocal` a las `03:40` ejecuta `scripts/run_reconcile_remote_to_local_scheduled_hidden.vbs` ‚Üí `scripts/run_reconcile_remote_to_local_scheduled.ps1` ‚Üí `scripts/reconcile_remote_to_local_once.py`.
- Logs generados:
  - Local‚ÜíRemoto: `backups/reconcile_local_remote_once.log`
  - Remoto‚ÜíLocal: `backups/reconcile_remote_to_local_once.log`
- Para ajustar o verificar:
  - Ejecutar manualmente: `schtasks /Run /TN "GymMS_Reconcile_LocalToRemote"` y `schtasks /Run /TN "GymMS_Reconcile_RemoteToLocal"`
  - Consultar detalle: `schtasks /Query /TN "GymMS_Reconcile_LocalToRemote" /V /FO LIST`
  - Cambiar horario: `schtasks /Change /TN "GymMS_Reconcile_LocalToRemote" /ST 03:10`
- Notas:
  - Los wrappers usan PowerShell con ruta absoluta y `PYTHONIOENCODING=utf-8` para evitar errores de codificaci√≥n.
  - Por defecto corren en modo "Interactivo" del usuario actual. Para ejecutar sin sesi√≥n iniciada, recrea las tareas con `/RU` y `/RP`.

### Token de seguridad: `SYNC_UPLOAD_TOKEN`
Para autorizar la subida de cambios locales al servidor, cliente y servidor deben compartir el mismo token.

#### Generar y configurar en Windows (PowerShell)

```powershell
# Generar un token aleatorio robusto
$token = "gymms_sync_" + ([Guid]::NewGuid().ToString("N")) + ([Guid]::NewGuid().ToString("N"))

# Usar el token en esta sesi√≥n y persistirlo para futuras sesiones
$env:SYNC_UPLOAD_TOKEN = $token
setx SYNC_UPLOAD_TOKEN $token

# (Opcional) Verificar
[Environment]::GetEnvironmentVariable("SYNC_UPLOAD_TOKEN", "User")
```

#### Configurar en el servidor (Railway u otro)
- En el panel del servicio web, a√±ade una variable de entorno `SYNC_UPLOAD_TOKEN` con el mismo valor.
- Reinicia el servicio para que tome el nuevo valor.

#### Validaci√≥n r√°pida
- Ejecuta `python scripts/install_outbox_triggers.py` para asegurar la tabla `public.sync_outbox`, la funci√≥n `public.sync_outbox_capture()` y los triggers.
- Inserta/actualiza datos en alguna tabla incluida y verifica que aparezcan registros en `public.sync_outbox`.
- Si la app est√° en ejecuci√≥n, el `OutboxPoller` sube los cambios autom√°ticamente. Manual: `python scripts/run_sync_uploader.py`.

#### Nota sobre URL del servidor
Si el cliente no detecta autom√°ticamente la URL del webapp, define `WEBAPP_BASE_URL`:

```powershell
setx WEBAPP_BASE_URL "https://tu-servidor.ejemplo"
```
