# ğŸ‹ï¸â€â™‚ï¸ Sistema de GestiÃ³n de Gimnasios Gym Management System v3.0

> **La soluciÃ³n integral mÃ¡s avanzada para la gestiÃ³n profesional de gimnasios y centros de fitness**

[![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)](https://python.org)
[![PyQt6](https://img.shields.io/badge/PyQt6-6.0+-green.svg)](https://www.riverbankcomputing.com/software/pyqt/)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-13+-blue.svg)](https://postgresql.org)
[![License](https://img.shields.io/badge/License-Proprietary-red.svg)]()

---

## ğŸš€ **Â¿Por quÃ© elegir Gym Management System?**

**Gym Management System** no es solo un software de gestiÃ³n, es la **plataforma empresarial completa** que transformarÃ¡ tu gimnasio en un negocio altamente eficiente y rentable. Con mÃ¡s de **50 caracterÃ­sticas avanzadas** y una arquitectura robusta, Gym Management System estÃ¡ diseÃ±ado para gimnasios que buscan **excelencia operativa** y **crecimiento sostenible**.

### ğŸ’¡ **Valor Diferencial**
- âš¡ **Rendimiento Superior**: BÃºsquedas en < 100ms, inicio en < 3 segundos
- ğŸ¯ **ROI Comprobado**: Reduce costos operativos hasta un 40%
- ğŸ“Š **Inteligencia de Negocio**: Dashboard ejecutivo con KPIs en tiempo real
- ğŸ”’ **Seguridad Empresarial**: AuditorÃ­a completa y respaldos automÃ¡ticos
- ğŸŒ **IntegraciÃ³n WhatsApp**: ComunicaciÃ³n automatizada con socios
- ğŸ“± **Interfaz Moderna**: DiseÃ±o intuitivo con accesibilidad completa

---

## ğŸ¯ **CaracterÃ­sticas Principales**

### ğŸ‘¥ **GestiÃ³n Integral de Socios**
- **Base de Datos Centralizada**: InformaciÃ³n completa de socios con historial detallado
- **Estados Inteligentes**: Activo, Inactivo, Moroso con indicadores visuales
- **Panel de Detalles Avanzado**: Vista 360Â° con historial de pagos, notas y mÃ©tricas
- **BÃºsqueda Global Ultra-RÃ¡pida**: Encuentra cualquier socio en milisegundos
- **GestiÃ³n de Documentos**: Almacenamiento seguro de contratos y documentaciÃ³n

### ğŸ’³ **Sistema de Pagos y FacturaciÃ³n**
- **Flujo de Trabajo Guiado**: Proceso simplificado para registro de cuotas
- **Recibos Profesionales PDF**: GeneraciÃ³n automÃ¡tica con diseÃ±o corporativo
- **Control de Morosidad**: Alertas automÃ¡ticas y seguimiento de pagos pendientes
- **Reportes Financieros**: AnÃ¡lisis detallado de ingresos y tendencias
- **MÃºltiples MÃ©todos de Pago**: Efectivo, transferencia, tarjeta con registro completo

### ğŸ’ª **Sistema Avanzado de Rutinas**
Un ecosistema completo para la creaciÃ³n y gestiÃ³n de planes de entrenamiento personalizados:

#### ğŸ¯ **CreaciÃ³n de Rutinas Personalizadas**
- **AsignaciÃ³n Individual**: Rutinas especÃ­ficas para cada socio
- **PlanificaciÃ³n Semanal**: DefiniciÃ³n de dÃ­as y ejercicios por jornada
- **ProgresiÃ³n AutomÃ¡tica**: Seguimiento de evoluciÃ³n y ajustes
- **CategorizaciÃ³n Inteligente**: OrganizaciÃ³n por objetivos y niveles

#### ğŸ“‹ **Plantillas y Grupos de Ejercicios**
- **Biblioteca de Plantillas**: Rutinas predefinidas (MusculaciÃ³n, Cardio, Funcional)
- **GestiÃ³n Colaborativa**: Acceso para dueÃ±os y profesores
- **ReutilizaciÃ³n Eficiente**: AplicaciÃ³n rÃ¡pida de plantillas probadas
- **PersonalizaciÃ³n Avanzada**: ModificaciÃ³n segÃºn necesidades especÃ­ficas

#### ğŸ‹ï¸ **Banco de Ejercicios Centralizado**
- **Base de Datos Completa**: CatÃ¡logo extenso de ejercicios por grupo muscular
- **ImportaciÃ³n/ExportaciÃ³n Masiva**: GestiÃ³n mediante Excel para actualizaciones rÃ¡pidas
- **DescripciÃ³n Detallada**: Instrucciones y objetivos para cada ejercicio
- **BÃºsqueda Inteligente**: Filtros por grupo muscular, objetivo y dificultad

#### ğŸ“„ **ExportaciÃ³n Profesional**
- **PDF Corporativo**: Rutinas con diseÃ±o profesional y branding
- **Excel Detallado**: Planillas completas para seguimiento
- **ImpresiÃ³n Optimizada**: Formato ideal para entrega a socios

### ğŸ§˜ **GestiÃ³n de Clases Grupales**
Sistema completo para la organizaciÃ³n de actividades grupales:

#### ğŸ“… **ProgramaciÃ³n de Clases**
- **GestiÃ³n de Horarios**: CreaciÃ³n y ediciÃ³n de cronogramas semanales
- **Tipos de Clases**: Yoga, Funcional, Spinning, Pilates, etc.
- **AsignaciÃ³n de Profesores**: Control de instructores por clase
- **GestiÃ³n de Cupos**: LÃ­mites automÃ¡ticos y control de capacidad

#### ğŸ‘¥ **InscripciÃ³n y Seguimiento**
- **InscripciÃ³n Simplificada**: Proceso rÃ¡pido para socios
- **Control de Capacidad**: Alertas automÃ¡ticas de cupos completos
- **Lista de Espera**: GestiÃ³n automÃ¡tica de socios en espera
- **Historial de Asistencia**: Seguimiento detallado por socio y clase

#### ğŸ¯ **Ejercicios por Clase**
- **Rutinas Predefinidas**: Ejercicios recomendados por tipo de clase
- **Consistencia de Entrenamiento**: Mantenimiento de estÃ¡ndares de calidad
- **Flexibilidad de AdaptaciÃ³n**: Modificaciones segÃºn nivel del grupo

### â° **Sistema de Control de Horas Extra para Profesores**
TecnologÃ­a avanzada para el seguimiento preciso del tiempo de trabajo:

#### ğŸ• **Funcionamiento del Sistema**
El sistema compara automÃ¡ticamente las **sesiones de trabajo reales** con los **horarios establecidos** para cada profesor:

- **DÃ­as Sin Horario**: Todo el tiempo trabajado se considera **horas extra**
- **DÃ­as Con Horario**: 
  - âœ… **Dentro del horario**: Se registra como horas normales
  - âš ï¸ **Fuera del horario**: Se registra como horas extra
  - ğŸ“Š **Parcialmente fuera**: DivisiÃ³n automÃ¡tica entre normales y extra

#### ğŸ“Š **CÃ¡lculo Inteligente**
- **Horas Trabajadas**: Solo incluye tiempo dentro del horario establecido
- **Horas Extra**: Incluye todo el tiempo adicional (fuera de horario + dÃ­as sin horario)
- **PrecisiÃ³n al Minuto**: CÃ¡lculos exactos con redondeo inteligente
- **Reportes Detallados**: Desglose completo por dÃ­a y perÃ­odo

#### ğŸ’¼ **Ejemplo PrÃ¡ctico**
```
Profesor Juan - Horario: Lunes 9:00-17:00
â€¢ SesiÃ³n Lunes 8:00-18:00 (10 horas)
  â†’ Horas Trabajadas: 8h (9:00-17:00)
  â†’ Horas Extra: 2h (8:00-9:00 + 17:00-18:00)

â€¢ SesiÃ³n Martes 10:00-14:00 (4 horas - sin horario)
  â†’ Horas Trabajadas: 0h
  â†’ Horas Extra: 4h (todo el dÃ­a)
```

### ğŸ‘¨â€ğŸ« **Sistema de Sesiones de Trabajo**
Control completo del tiempo de trabajo de profesores con precisiÃ³n empresarial:

#### ğŸ” **Inicio y Cierre AutomÃ¡tico**
- **Login Inteligente**: Inicio automÃ¡tico de sesiÃ³n al ingresar al sistema
- **DetecciÃ³n de Rol**: ActivaciÃ³n solo para profesores de musculaciÃ³n
- **Sesiones Activas**: DetecciÃ³n y continuaciÃ³n de sesiones existentes
- **Cierre AutomÃ¡tico**: FinalizaciÃ³n al cerrar sesiÃ³n o salir del sistema

#### â±ï¸ **Seguimiento en Tiempo Real**
- **CronÃ³metro Preciso**: MediciÃ³n exacta hasta el segundo
- **Persistencia de Datos**: Mantenimiento de sesiones entre reinicios
- **MÃºltiples Sesiones**: Soporte para varios profesores simultÃ¡neos
- **VerificaciÃ³n de Integridad**: ValidaciÃ³n automÃ¡tica de datos

#### ğŸ“ˆ **Reportes y AnÃ¡lisis**
- **Historial Completo**: Registro detallado de todas las sesiones
- **MÃ©tricas por Profesor**: EstadÃ­sticas individuales y comparativas
- **AnÃ¡lisis de Productividad**: IdentificaciÃ³n de patrones de trabajo
- **ExportaciÃ³n de Datos**: Reportes para nÃ³mina y administraciÃ³n

### ğŸ“± **Sistema de MensajerÃ­a WhatsApp**
IntegraciÃ³n completa con WhatsApp Business API para comunicaciÃ³n automatizada:

#### âš™ï¸ **ConfiguraciÃ³n Empresarial**
- **WhatsApp Business API**: IntegraciÃ³n oficial con credenciales seguras
- **App ID y Secret**: ConfiguraciÃ³n de aplicaciÃ³n empresarial
- **Access Token**: AutenticaciÃ³n segura para envÃ­o de mensajes
- **Webhook Configuration**: RecepciÃ³n de mensajes entrantes

#### ğŸ¤– **AutomatizaciÃ³n Inteligente**
- **ConfirmaciÃ³n AutomÃ¡tica**: Respuestas instantÃ¡neas a mensajes recibidos
- **Recordatorios de Pago**: Notificaciones automÃ¡ticas para socios morosos
- **Mensajes de Bienvenida**: ComunicaciÃ³n personalizada para nuevos socios
- **Respuestas Programadas**: Sistema de respuestas automÃ¡ticas configurables

#### ğŸ“Š **GestiÃ³n y Monitoreo**
- **Log de Mensajes**: Registro completo de comunicaciones
- **Estado de Entrega**: Seguimiento de mensajes enviados y recibidos
- **Manejo de Errores**: Sistema robusto de recuperaciÃ³n ante fallos
- **ConfiguraciÃ³n Flexible**: ActivaciÃ³n/desactivaciÃ³n de funciones especÃ­ficas

### ğŸ“Š **Dashboard Ejecutivo y Reportes Avanzados**
Centro de inteligencia de negocio con mÃ©tricas empresariales en tiempo real:

#### ğŸ¯ **KPIs EstratÃ©gicos**
- **Socios Activos**: Usuarios con acceso vigente al gimnasio
- **Ingresos del Mes**: FacturaciÃ³n actualizada en tiempo real
- **ARPU (Average Revenue Per User)**: Ingreso promedio por socio activo
- **Tasa de RetenciÃ³n**: Porcentaje de socios que renuevan mensualmente
- **Socios Morosos**: IdentificaciÃ³n automÃ¡tica de pagos pendientes
- **Nuevos Socios (30 dÃ­as)**: Seguimiento de captaciÃ³n mensual

#### ğŸ“ˆ **AnÃ¡lisis de Inteligencia de Negocio**
- **GrÃ¡ficos Evolutivos**: Tendencias de facturaciÃ³n y crecimiento
- **AnÃ¡lisis de Asistencia**: Patrones de uso y horarios pico
- **Capacidad de Clases**: OcupaciÃ³n promedio y optimizaciÃ³n de recursos
- **Crecimiento de Ingresos**: Comparativas mensuales y proyecciones
- **Eficiencia Operacional**: MÃ©tricas de productividad del gimnasio

#### ğŸš¨ **Sistema de Alertas Inteligentes**
- **Umbrales Configurables**: Alertas personalizadas por mÃ©trica
- **Notificaciones CrÃ­ticas**: Avisos automÃ¡ticos para situaciones importantes
- **Tendencias Negativas**: DetecciÃ³n temprana de problemas operativos
- **Oportunidades de Mejora**: IdentificaciÃ³n de Ã¡reas de crecimiento

#### ğŸ“„ **ExportaciÃ³n Profesional**
- **Reportes PDF**: Documentos ejecutivos con diseÃ±o corporativo
- **Excel Detallado**: Datos completos para anÃ¡lisis avanzado
- **CSV para IntegraciÃ³n**: Compatibilidad con sistemas externos
- **ProgramaciÃ³n AutomÃ¡tica**: GeneraciÃ³n y envÃ­o automÃ¡tico de reportes

### ğŸ”§ **Herramientas de Mantenimiento y AdministraciÃ³n**

#### ğŸ¥ **DiagnÃ³sticos del Sistema**
- **Monitoreo en Tiempo Real**: CPU, memoria, disco y base de datos
- **AnÃ¡lisis de Rendimiento**: IdentificaciÃ³n de cuellos de botella
- **Alertas de Salud**: Notificaciones automÃ¡ticas de problemas
- **Recomendaciones Inteligentes**: Sugerencias de optimizaciÃ³n

#### ğŸ—„ï¸ **GestiÃ³n de Base de Datos**
- **Respaldos AutomÃ¡ticos**: Copias de seguridad programadas
- **OptimizaciÃ³n AutomÃ¡tica**: Mantenimiento preventivo de tablas
- **VerificaciÃ³n de Integridad**: ValidaciÃ³n automÃ¡tica de datos
- **Herramientas de RecuperaciÃ³n**: RestauraciÃ³n rÃ¡pida ante fallos

#### ğŸ” **AuditorÃ­a y Seguridad**
- **Log Completo de Actividades**: Registro detallado de todas las operaciones
- **Seguimiento de Usuarios**: Historial de acciones por usuario
- **AnÃ¡lisis de Patrones**: DetecciÃ³n de actividades inusuales
- **Reportes de Seguridad**: DocumentaciÃ³n para auditorÃ­as

### ğŸ¨ **PersonalizaciÃ³n y Accesibilidad**

#### ğŸ–Œï¸ **Branding Corporativo**
- **PersonalizaciÃ³n Visual**: Colores, logos y tipografÃ­as corporativas
- **Temas DinÃ¡micos**: Modo claro y oscuro con transiciones suaves
- **DiseÃ±o Responsive**: AdaptaciÃ³n automÃ¡tica a diferentes resoluciones
- **Elementos Personalizables**: Iconos, botones y componentes visuales

#### â™¿ **Accesibilidad Universal**
- **Soporte para Lectores de Pantalla**: Compatibilidad NVDA y JAWS
- **NavegaciÃ³n por Teclado**: Acceso completo sin mouse
- **Alto Contraste**: Modos visuales para usuarios con discapacidad visual
- **TamaÃ±os de Fuente Ajustables**: Escalado dinÃ¡mico de texto
- **Alertas Sonoras**: Notificaciones auditivas configurables

---

## ğŸ› ï¸ **Arquitectura TÃ©cnica**

### ğŸ’» **Stack TecnolÃ³gico**
- **Frontend**: PyQt6 con diseÃ±o modular y componentes reutilizables
- **Backend**: Python 3.8+ con arquitectura orientada a objetos
- **Base de Datos**: PostgreSQL 13+ con optimizaciones empresariales
- **Reportes**: ReportLab para PDFs profesionales
- **GrÃ¡ficos**: Matplotlib con visualizaciones interactivas
- **AnÃ¡lisis**: Pandas para procesamiento de datos masivos
- **Concurrencia**: Threading para operaciones asÃ­ncronas

### ğŸ—ï¸ **Arquitectura del Sistema**
```
gym-management-system/
â”œâ”€â”€ main.py                 # AplicaciÃ³n principal y punto de entrada
â”œâ”€â”€ database.py            # GestiÃ³n de base de datos y ORM personalizado
â”œâ”€â”€ models.py              # Modelos de datos y entidades de negocio
â”œâ”€â”€ widgets/               # Componentes de interfaz modular
â”‚   â”œâ”€â”€ users_tab_widget.py           # GestiÃ³n de socios
â”‚   â”œâ”€â”€ payments_tab_widget.py        # Sistema de pagos
â”‚   â”œâ”€â”€ professors_tab_widget.py      # GestiÃ³n de profesores
â”‚   â”œâ”€â”€ routines_tab_widget.py        # Sistema de rutinas
â”‚   â”œâ”€â”€ classes_tab_widget.py         # Clases grupales
â”‚   â”œâ”€â”€ reports_tab_widget.py         # Dashboard y reportes
â”‚   â”œâ”€â”€ whatsapp_config_widget.py     # ConfiguraciÃ³n WhatsApp
â”‚   â”œâ”€â”€ system_diagnostics_widget.py  # DiagnÃ³sticos del sistema
â”‚   â””â”€â”€ audit_dashboard_widget.py     # AuditorÃ­a y seguridad
â”œâ”€â”€ managers/              # Gestores de lÃ³gica de negocio
â”‚   â”œâ”€â”€ whatsapp_manager.py          # IntegraciÃ³n WhatsApp
â”‚   â”œâ”€â”€ export_manager.py            # ExportaciÃ³n de datos
â”‚   â”œâ”€â”€ payment_manager.py           # Procesamiento de pagos
â”‚   â””â”€â”€ search_manager.py            # Motor de bÃºsqueda
â”œâ”€â”€ utils_modules/         # MÃ³dulos de utilidades
â”‚   â”œâ”€â”€ accessibility_manager.py     # GestiÃ³n de accesibilidad
â”‚   â”œâ”€â”€ audit_logger.py             # Sistema de auditorÃ­a
â”‚   â””â”€â”€ keyboard_manager.py         # NavegaciÃ³n por teclado
â””â”€â”€ styles/               # Hojas de estilo dinÃ¡micas
    â”œâ”€â”€ light_theme.qss              # Tema claro
    â””â”€â”€ dark_theme.qss               # Tema oscuro
```

---

## ğŸ”§ ConfiguraciÃ³n de Base de Datos (Local)

- La app de escritorio ahora viene preparada para usar una base local por defecto.
- Valores por defecto (editables): `host=localhost`, `port=5432`, `database=gimnasio`, `user=postgres`, `sslmode=prefer`.
- Abre `cdbconfig.py` y utiliza el botÃ³n `Probar conexiÃ³n local` para validar rÃ¡pidamente la conexiÃ³n a tu PostgreSQL local. Esta prueba ahora estÃ¡ centralizada y usa `DatabaseManager.test_connection()`.
- La contraseÃ±a se guarda de forma segura en el almacÃ©n del sistema (keyring). Si no hay keyring disponible, puedes optar por guardarla en `config/config.json` como respaldo.
- Importante: Si tienes variables de entorno `DB_*` definidas, tienen prioridad sobre `config.json`. ElimÃ­nalas o ajÃºstalas si quieres forzar los valores locales.

### Ejemplo de conexiÃ³n local

1) Instala PostgreSQL localmente y crea la base `gimnasio`.
2) Ejecuta `python cdbconfig.py`, ingresa los parÃ¡metros locales y presiona `Probar conexiÃ³n local`.
3) Presiona `Guardar` para persistir los cambios en `config/config.json` y almacenar la contraseÃ±a en el keyring.

---

## ğŸ”§ ConfiguraciÃ³n de Base de Datos (Railway)

- Edita la configuraciÃ³n desde el escritorio con `cdbconfig.py` (menÃº: ConfiguraciÃ³n de Base de Datos). Las pruebas de conexiÃ³n utilizan la API central `DatabaseManager.test_connection()` para mantener un comportamiento consistente.
- Campos configurables: `host`, `port`, `database`, `user`, `password`, `sslmode`, `connect_timeout`, `application_name`.
- Usa los datos provistos por Railway Postgres:
  - `host`: host de Railway (ej. `containers-us-west-xxx.railway.app`)
  - `port`: puerto asignado por Railway
  - `database`: comÃºnmente `railway`
  - `user`: comÃºnmente `postgres`
  - `sslmode`: recomienda `require`
- La configuraciÃ³n se guarda en `config/config.json` y la contraseÃ±a en el almacÃ©n seguro del sistema (keyring). Opcionalmente, puedes guardar la contraseÃ±a en `config.json` como respaldo.
- Nota: Las variables de entorno `DB_HOST`, `DB_PORT`, `DB_NAME`, `DB_USER`, `DB_PASSWORD`, `DB_SSLMODE`, `DB_CONNECT_TIMEOUT`, `DB_APPLICATION_NAME` tienen prioridad sobre `config.json`.

### API de conexiÃ³n centralizada

- MÃ©todo: `DatabaseManager.test_connection(params: dict | None) -> bool`
- Comportamiento:
  - Si `params` es `None`, intenta resolver parÃ¡metros desde entorno (`DB_*`) y defaults.
  - Si se proveen parÃ¡metros, se mapean a `psycopg2.connect` (`host`, `port`, `database`->`dbname`, `user`, `password`, `sslmode`, `connect_timeout`, `application_name`, `options`).
  - Ejecuta `SELECT 1` y cierra la conexiÃ³n. Devuelve `True/False`.
- Beneficios: una Ãºnica implementaciÃ³n para pruebas, timeouts consistentes y soporte de `options` para timeouts de sesiÃ³n.

### Comando de inicio web sugerido (Railway)

- `python -m uvicorn webapp.server:app --host 0.0.0.0 --port ${PORT}`
- Asegura que las variables de entorno de Railway Postgres estÃ©n disponibles (mapÃ©alas a las variables `DB_*` si cambian de nombre).

### ğŸ”’ **Seguridad y Confiabilidad**
- **EncriptaciÃ³n de Datos**: ProtecciÃ³n de informaciÃ³n sensible
- **ValidaciÃ³n de Entrada**: PrevenciÃ³n de inyecciÃ³n SQL y XSS
- **GestiÃ³n de Sesiones**: Control seguro de acceso de usuarios
- **Respaldos AutomÃ¡ticos**: Copias de seguridad programadas
- **Log de AuditorÃ­a**: Registro completo de actividades
- **RecuperaciÃ³n ante Fallos**: Mecanismos de recuperaciÃ³n automÃ¡tica

---

## ğŸ“ˆ **MÃ©tricas de Rendimiento**

### âš¡ **Benchmarks Comprobados**
- **Tiempo de Inicio**: < 3 segundos en hardware estÃ¡ndar
- **BÃºsqueda Global**: < 100ms para bases de datos de hasta 10,000 registros
- **GeneraciÃ³n de Reportes**: < 5 segundos para reportes mensuales completos
- **Uso de Memoria**: < 150MB en operaciÃ³n normal
- **Tiempo de Respuesta**: < 50ms para operaciones CRUD bÃ¡sicas
- **Capacidad de Usuarios**: Soporte para hasta 5,000 socios activos

### ğŸ–¥ï¸ **Compatibilidad**
- **Windows**: 10/11 (x64)
- **macOS**: 10.15+ (Intel/Apple Silicon)
- **Linux**: Ubuntu 20.04+, CentOS 8+, Debian 11+
- **Memoria RAM**: MÃ­nimo 4GB, Recomendado 8GB
- **Espacio en Disco**: 2GB para instalaciÃ³n + datos
- **Procesador**: Intel i3/AMD Ryzen 3 o superior

---

## ğŸš€ **InstalaciÃ³n y ConfiguraciÃ³n**

### ğŸ“‹ **Requisitos Previos**
```bash
# Python 3.8 o superior
python --version

# PostgreSQL 13 o superior
psql --version

# Git para clonaciÃ³n del repositorio
git --version
```

### âš™ï¸ **InstalaciÃ³n RÃ¡pida**
```bash
# 1. Clonar el repositorio
git clone https://github.com/tu-usuario/gym-management-system.git
cd gym-management-system

# 2. Crear entorno virtual
python -m venv venv
source venv/bin/activate  # Linux/Mac
# o
venv\Scripts\activate     # Windows

# 3. Instalar dependencias
pip install -r requirements.txt

# 4. Configurar base de datos
python initialize_database.py

# 5. Ejecutar la aplicaciÃ³n
python main.py
```

### ğŸ” ReplicaciÃ³n lÃ³gica PostgreSQL (bidireccional)

La aplicaciÃ³n no incluye ni inicia motores externos de replicaciÃ³n. La sincronizaciÃ³n entre la base local y la base en Railway se realiza mediante replicaciÃ³n lÃ³gica nativa de PostgreSQL (publications/subscriptions), administrada exclusivamente desde los servidores de base de datos.

GuÃ­a de alto nivel:
- Crear una `PUBLICATION` en la base origen para las tablas a replicar.
- Crear una `SUBSCRIPTION` en la base destino apuntando a la publicaciÃ³n, con un rol y conexiÃ³n seguros.
- Ajustar filtros de tablas segÃºn necesidad (excluir temporales/auditorÃ­a si corresponde).

Ejemplo mÃ­nimo (adaptar a tu esquema y credenciales):

```sql
-- En la base origen (Railway o local, segÃºn diseÃ±o):
CREATE PUBLICATION gym_pub FOR ALL TABLES;

-- En la base destino:
CREATE SUBSCRIPTION gym_sub
  CONNECTION 'host=<HOST> port=<PORT> dbname=<DB> user=<USER> password=<PASS> sslmode=require'
  PUBLICATION gym_pub;
```

VerificaciÃ³n rÃ¡pida (PostgreSQL):
- Consultar `pg_stat_subscription` en la base destino para ver el estado de la suscripciÃ³n.
- Consultar `pg_publication`/`pg_publication_tables` en la base origen para revisar la publicaciÃ³n.
- Probar inserciones/actualizaciones/eliminaciones y confirmar reflectancia en la contraparte.

AutomatizaciÃ³n con script:
- Ejecuta `python scripts/setup_logical_replication.py` para crear/asegurar la `PUBLICATION` remota (`gym_pub`) y la `SUBSCRIPTION` local (`gym_sub`).
- El script lee `config/config.json` y admite variables de entorno: `PGREMOTE_DSN`, `PGREMOTE_PASSWORD`, `PGREMOTE_USER`, `PGLOCAL_DSN`, `PGLOCAL_PASSWORD`.
- Si no hay contraseÃ±a remota en entorno/DSN, intenta obtenerla de `keyring` (Windows Credential Manager) bajo el servicio `GymMS_DB`.
- Tras ejecutar, verifica estado con: `SELECT subname, sync_state, apply_lag FROM pg_stat_subscription;` en la base local.

Limpieza de artefactos antiguos:
- Si existen objetos heredados `sym_%` de motores previos de replicaciÃ³n, elimÃ­nalos manualmente (DROP) o con tus propios scripts; este proyecto no incluye `scripts/cleanup_symmetricds.sql`.

### ğŸ”§ **ConfiguraciÃ³n Inicial**
1. **Base de Datos**: Configurar conexiÃ³n PostgreSQL en `config.py`
2. **WhatsApp Business**: Obtener credenciales de Meta Business
3. **PersonalizaciÃ³n**: Configurar branding y temas corporativos
4. **Usuarios**: Crear cuenta de administrador inicial
5. **Respaldos**: Configurar programaciÃ³n de copias de seguridad

---

## ğŸ†• **Novedades de la VersiÃ³n 3.0**

### ğŸ¯ **Nuevas CaracterÃ­sticas**
- âœ¨ **Sistema de Horas Extra**: Control automÃ¡tico de tiempo de trabajo
- ğŸ“± **IntegraciÃ³n WhatsApp**: ComunicaciÃ³n automatizada con socios
- ğŸ‹ï¸ **Rutinas Avanzadas**: Sistema completo de entrenamiento personalizado
- ğŸ§˜ **Clases Grupales**: GestiÃ³n integral de actividades grupales
- ğŸ“Š **Dashboard Ejecutivo**: KPIs y mÃ©tricas empresariales en tiempo real
- ğŸ” **AuditorÃ­a Completa**: Sistema de seguimiento y seguridad avanzado

### ğŸš€ **Mejoras de Rendimiento**
- âš¡ **50% mÃ¡s rÃ¡pido** en bÃºsquedas globales
- ğŸ’¾ **30% menos uso de memoria** en operaciones masivas
- ğŸ”„ **Carga asÃ­ncrona** para mejor experiencia de usuario
- ğŸ“ˆ **OptimizaciÃ³n de consultas** SQL para reportes complejos

### ğŸ¨ **Experiencia de Usuario**
- ğŸ–Œï¸ **Interfaz renovada** con diseÃ±o moderno y profesional
- â™¿ **Accesibilidad completa** para usuarios con discapacidades
- ğŸŒ™ **Modo oscuro** con transiciones suaves
- âŒ¨ï¸ **NavegaciÃ³n por teclado** mejorada

---

## ğŸ’¼ **Casos de Uso Empresariales**

### ğŸ¢ **Gimnasios Boutique (50-200 socios)**
- GestiÃ³n personalizada de socios VIP
- Rutinas individualizadas por entrenador personal
- ComunicaciÃ³n directa vÃ­a WhatsApp
- Reportes ejecutivos para toma de decisiones

### ğŸ­ **Cadenas de Gimnasios (200-1000 socios)**
- Dashboard centralizado multi-sucursal
- AnÃ¡lisis comparativo de rendimiento
- AutomatizaciÃ³n de procesos operativos
- IntegraciÃ³n con sistemas de nÃ³mina

### ğŸŒŸ **Centros de Alto Rendimiento (1000+ socios)**
- MÃ©tricas avanzadas de retenciÃ³n y crecimiento
- Sistema de auditorÃ­a para compliance
- Reportes automÃ¡ticos para inversores
- Escalabilidad empresarial comprobada

---

## ğŸ¯ **ROI y Beneficios Empresariales**

### ğŸ’° **Retorno de InversiÃ³n**
- **ReducciÃ³n de Costos Operativos**: Hasta 40% menos tiempo en tareas administrativas
- **Aumento de RetenciÃ³n**: Mejora del 25% en renovaciÃ³n de socios
- **OptimizaciÃ³n de Recursos**: 30% mejor utilizaciÃ³n de profesores y espacios
- **ReducciÃ³n de Errores**: 95% menos errores en facturaciÃ³n y pagos

### ğŸ“Š **MÃ©tricas de Ã‰xito**
- **Tiempo de RecuperaciÃ³n**: 3-6 meses tÃ­picamente
- **Ahorro Anual**: $15,000 - $50,000 USD segÃºn tamaÃ±o del gimnasio
- **Productividad**: 60% menos tiempo en reportes manuales
- **SatisfacciÃ³n**: 90%+ de satisfacciÃ³n de usuarios finales

---

## ğŸ¤ **Soporte y Servicios**

### ğŸ“ **Soporte TÃ©cnico**
- **InstalaciÃ³n Guiada**: ConfiguraciÃ³n completa incluida
- **CapacitaciÃ³n del Personal**: Entrenamiento presencial o virtual
- **Soporte 24/7**: Asistencia tÃ©cnica continua
- **Actualizaciones AutomÃ¡ticas**: Nuevas caracterÃ­sticas sin costo adicional

### ğŸ“ **Servicios Profesionales**
- **MigraciÃ³n de Datos**: ImportaciÃ³n desde sistemas existentes
- **PersonalizaciÃ³n Avanzada**: Desarrollo de caracterÃ­sticas especÃ­ficas
- **IntegraciÃ³n con Terceros**: ConexiÃ³n con sistemas de pago, contabilidad, etc.
- **ConsultorÃ­a de Procesos**: OptimizaciÃ³n de flujos de trabajo

---

## ğŸ“ **Contacto y Ventas**

### ğŸ¢ **InformaciÃ³n Comercial**
- **Email**: piedrabuena.mateo03@gmail.com
- **TelÃ©fono**: +54 343 4473599
- **WhatsApp Business**: +54 9 343 4473599
- **Sitio Web**: www.gym-management-system.com

### ğŸ’¬ **Solicitar Demo**
Â¿Quieres ver Gym Management System en acciÃ³n? Agenda una demostraciÃ³n personalizada:
- **Demo Online**: 30 minutos de presentaciÃ³n interactiva
- **Prueba Gratuita**: 14 dÃ­as de acceso completo
- **Visita Presencial**: DemostraciÃ³n en tu gimnasio
- **AnÃ¡lisis de Necesidades**: ConsultorÃ­a gratuita de procesos

---

## ğŸ“„ **Licencia y TÃ©rminos**

Este software es **propiedad exclusiva** de Gym Management System. Todos los derechos reservados.
Para informaciÃ³n sobre licenciamiento empresarial, contactar al equipo comercial.

---

<div align="center">

**ğŸ‹ï¸â€â™‚ï¸ Gym Management System - Transformando Gimnasios en Empresas de Ã‰xito ğŸ‹ï¸â€â™€ï¸**

</div>



python build_installer.py --mode onefile
### ğŸŒ **Acceso Web PÃºblico (Railway recomendado)**
- El servidor web se inicia automÃ¡ticamente en `main.py` y en el lanzador web `GymMSW.py` usando `start_web_server`.
- La URL pÃºblica ya no depende de LocalTunnel: se resuelve con `get_webapp_base_url()` (por defecto `https://gym-ms-zrk.up.railway.app`).
- `start_public_tunnel` actÃºa como un no-op y retorna la URL pÃºblica configurada.
- La URL pÃºblica se abre automÃ¡ticamente en el navegador en `main.py` y se muestra en la ventana/tray de `GymMSW.py`.

#### ğŸ”§ ConfiguraciÃ³n de URL PÃºblica
- Archivo `config/config.json` (preferido):
```
{
  "host": "localhost",
  "port": 5432,
  "database": "gimnasio",
  "user": "postgres",
  "sslmode": "prefer",
  "connect_timeout": 10,
  "application_name": "gym_management_system",
  "webapp_base_url": "https://gym-ms-zrk.up.railway.app",
  "public_tunnel": {
    "subdomain": "gym-ms-zrk",
    "enabled": false
  }
}
```
- Variables de entorno:
  - `WEBAPP_BASE_URL=https://gym-ms-zrk.up.railway.app`
  - `PUBLIC_TUNNEL_ENABLED=0` (recomendado en Railway)

#### ğŸš€ Arranque y Uso
- Desarrollo (aplicaciÃ³n completa): `python main.py`
  - Inicia servidor web y resuelve URL pÃºblica con `get_webapp_base_url()`.
  - Abre el navegador en la URL pÃºblica detectada (p. ej., `https://gym-ms-zrk.up.railway.app/`).
- Si `public_tunnel.enabled` es `false` o `PUBLIC_TUNNEL_ENABLED=0`, se omiten intentos de tÃºnel y se usa la URL de Railway.
- Desarrollo (solo web launcher): `python GymMSW.py`
  - Inicia servidor web y muestra ventana/tray con enlaces local y pÃºblico.
  - Si el tÃºnel pÃºblico estÃ¡ deshabilitado, el enlace pÃºblico se omite.

#### ğŸ” ContraseÃ±as y Recordatorios
- En la configuraciÃ³n Railway no se requiere contraseÃ±a de tÃºnel.
- El endpoint `GET /tunnel/password` queda deshabilitado y retorna `{ password: null, ok: false }`.
  - Nota: navegadores estÃ¡ndar seguirÃ¡n mostrando la pÃ¡gina; comparte la contraseÃ±a con tus visitantes.

### ğŸ› ï¸ **ConstrucciÃ³n de Ejecutables**
- Ejecutable standalone: `python build_installer.py --mode onefile`
- Carpeta de salida: `dist/` (contiene ejecutables y recursos).
- Ejecutables generados:
  - `GymMSW.exe`: lanzador web con indicador y bandeja del sistema.
  - `Gym_Management_System.exe`: aplicaciÃ³n principal empaquetada.
  - `cdbconfig.exe`: editor de configuraciÃ³n de base de datos.

#### âœ… Verificaciones previas al build
- Crea `logs/` en el proyecto si no existe para evitar `FileNotFoundError` en runtime.
- Muestra versiones detectadas de dependencias clave (`fastapi`, `uvicorn`, `starlette`, `psycopg2`) y las compara con `requirements.txt`.
- Genera bootstrap remoto desde variables de entorno si estÃ¡n definidas.

#### ğŸ§© psycopg2 y dependencias nativas
- Detecta la carpeta `psycopg2.libs` y la incluye en el build (`libpq`, `ssl`, etc.).
- Si `psycopg2` no estÃ¡ instalado, intenta instalar `psycopg2-binary` automÃ¡ticamente antes del empaquetado.
- En `dist/lib/` deben existir `psycopg2/` y `psycopg2.libs/` tras el build.

#### ğŸ” Reproducibilidad del build
- Usa entorno virtual: `python -m venv venv && venv\Scripts\activate`.
- Instala dependencias: `pip install -r requirements.txt`.
- Ejecuta: `python build_installer.py` (opcional `--msi` en Windows para instalador MSI).
- No se requiere servidor de tÃºnel ni procesos adicionales; el build es determinista.

#### ğŸ“ Notas de logging
- El sistema escribe en `logs/` (raÃ­z del proyecto). Si el directorio no existe, se crea automÃ¡ticamente en tiempo de ejecuciÃ³n.
- Se reforzÃ³ el manejo defensivo en `utils_modules/users_loader.py` para crear `logs/` al escribir `logs/cache_metrics.json`.
- La configuraciÃ³n de logging se inicializa temprano en `main.py` vÃ­a `logger_config.setup_logging()`.

### ğŸ¨ **Estilos DinÃ¡micos y Branding**
- Los estilos `styles/style.qss` se aplican y se enriquecen con CSS dinÃ¡mico.
- Se utilizan variables de branding (colores, tipografÃ­as, logos) desde base de datos o configuraciÃ³n.
- Widgets relevantes: `branding_customization_widget.py`, `accessibility_widget.py`, `chart_widget.py`.

### ğŸ§¹ **Cierre Seguro del TÃºnel**
- Al salir, se intenta terminar procesos del tÃºnel pÃºblico (`terminate_tunnel_processes`) y cualquier `ssh.exe` residual (`terminate_ssh_processes`).
- Existe un cierre defensivo adicional reutilizado desde `main.py`.

## ğŸ”„ SincronizaciÃ³n bidireccional (Outbox + ReplicaciÃ³n)
- ReplicaciÃ³n lÃ³gica Postgres (remoto â†’ local) ya automatizada por el sistema.
- Outbox con triggers (local â†’ remoto) capturando cambios en todas las tablas listadas en `config/sync_tables.json`.

### Token de seguridad: `SYNC_UPLOAD_TOKEN`
Para autorizar la subida de cambios locales al servidor, cliente y servidor deben compartir el mismo token.

#### Generar y configurar en Windows (PowerShell)

```powershell
# Generar un token aleatorio robusto
$token = "gymms_sync_" + ([Guid]::NewGuid().ToString("N")) + ([Guid]::NewGuid().ToString("N"))

# Usar el token en esta sesiÃ³n y persistirlo para futuras sesiones
$env:SYNC_UPLOAD_TOKEN = $token
setx SYNC_UPLOAD_TOKEN $token

# (Opcional) Verificar
[Environment]::GetEnvironmentVariable("SYNC_UPLOAD_TOKEN", "User")
```

#### Configurar en el servidor (Railway u otro)
- En el panel del servicio web, aÃ±ade una variable de entorno `SYNC_UPLOAD_TOKEN` con el mismo valor.
- Reinicia el servicio para que tome el nuevo valor.

#### ValidaciÃ³n rÃ¡pida
- Ejecuta `python scripts/install_outbox_triggers.py` para asegurar la tabla `public.sync_outbox`, la funciÃ³n `public.sync_outbox_capture()` y los triggers.
- Inserta/actualiza datos en alguna tabla incluida y verifica que aparezcan registros en `public.sync_outbox`.
- Si la app estÃ¡ en ejecuciÃ³n, el `OutboxPoller` sube los cambios automÃ¡ticamente. Manual: `python scripts/run_sync_uploader.py`.

#### Nota sobre URL del servidor
Si el cliente no detecta automÃ¡ticamente la URL del webapp, define `WEBAPP_BASE_URL`:

```powershell
setx WEBAPP_BASE_URL "https://tu-servidor.ejemplo"
```
