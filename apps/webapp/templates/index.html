<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Acceso • {{ gym_name }}</title>
  <link rel="stylesheet" href="/static/style.css" />
  <link rel="stylesheet" href="/theme.css" />
  <link rel="preconnect" href="https://cdn.jsdelivr.net" />
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
  <script src="/static/js/utils.js"></script>
  
  <link rel="icon" href="{{ logo_url }}" />
  <meta name="theme-color" content="{{ theme['--primary'] if theme and '--primary' in theme else '#2b8a3e' }}">
  <meta name="color-scheme" content="dark light">
  <style>
    .screen { min-height: 100vh; display: grid; place-items: center; padding: 24px; background: var(--bg); }
    .selector-wrapper { width: 100%; max-width: 720px; }
    .card { padding: 20px; border-radius: 16px; background: var(--card); border: 1px solid var(--border); box-shadow: 0 10px 24px rgba(0,0,0,.25); }
    .brand { display:flex; align-items:center; gap:12px; margin-bottom: 16px; }
    .brand img { width: 44px; height: 44px; }
    h1 { margin: 0; font-size: 20px; }
    .brand .muted { margin: 2px 0 0 0; line-height: 1.3; }
    .grid { display:grid; grid-template-columns: repeat(2, minmax(260px, 340px)); gap:12px; }
    @media (max-width: 720px){ .grid { grid-template-columns: 1fr; } }
    .option-card { padding: 20px; border-radius: 12px; background: var(--card); border: 1px solid var(--border); box-shadow: 0 6px 16px rgba(0,0,0,.18); transition: transform 120ms ease, box-shadow 120ms ease; position: relative; cursor: pointer; }
    .option-card:hover { transform: translateY(-2px); box-shadow: 0 10px 22px rgba(0,0,0,.24); }
    .option-card:focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; }
    .option-title { font-weight:600; font-size: 18px; }
    .option-icon { width: 28px; height: 28px; border-radius: 8px; display:inline-flex; align-items:center; justify-content:center; background: rgba(255,255,255,.06); margin-right:8px; overflow: hidden; }
    .option-icon img { width: 22px; height: 22px; border-radius: 6px; }
    .option-icon i { font-size: 20px; line-height: 1; color: var(--text); }
    .option-card:hover .option-icon i { color: var(--accent); }
    .option-card:hover .option-icon { background: rgba(255,255,255,.10); }
    .role-chip { display:inline-block; font-size:12px; color: var(--text); background: rgba(255,255,255,.06); border: 1px solid var(--border); border-radius: 999px; padding: 2px 8px; margin-left: 8px; }
    .desc { color: var(--muted); margin-top: 6px; }
    .actions { margin-top: 12px; display:flex; gap: 8px; }
    a.btn { text-decoration: none; display:inline-block; }
    .btn:focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; }
    .btn.tertiary { background: var(--accent); }
    .btn.checkin-cta { font-weight: 600; }
    @media (max-width: 480px) { .btn.checkin-cta { padding: 14px 18px; font-size: 16px; width: auto; } }
    @media (prefers-reduced-motion: reduce) { .option-card:hover { transform: none; box-shadow: 0 6px 16px rgba(0,0,0,.18); } }
    footer .links { display:flex; gap:8px; justify-content:center; flex-wrap:wrap; }
    footer .links a { color: var(--text); text-decoration: none; }

/* === ESTILOS PARA EL BOTÓN FLOTANTE DE WHATSAPP === */
    .whatsapp-container {
        position: fixed; /* Esto asegura que esté anclado y no se mueva */
        bottom: 20px;  
        left: 20px;      
        z-index: var(--z-modal-backdrop, 1000); 
        display: flex;
        align-items: center;
    }

    /* Estilos del botón circular */
    .floating-whatsapp-btn {
        background-color: var(--accent); /* Usa color 'copper' */
        color: white;
        width: 50px;     
        height: 50px;    
        border-radius: 50%; 
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px; 
        text-decoration: none; 
        box-shadow: var(--shadow-md); /* Usa sombra de CSS */
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    /* Animación de foco al pasar el mouse */
    .floating-whatsapp-btn:hover {
        transform: scale(1.1); 
        box-shadow: var(--shadow-lg); /* Usa sombra más grande */
    }

    /* Estilos del texto "Contactame" (tooltip) */
    .whatsapp-tooltip {
        visibility: hidden; 
        opacity: 0;
        position: absolute;
        left: 62px; 
        
        /* Estos estilos usan variables, así que se ven bien */
        background-color: var(--card); 
        color: var(--text); 
        border: 1px solid var(--border); 
        padding: 6px 12px;
        border-radius: 6px; 
        white-space: nowrap; 
        font-size: 14px;
        box-shadow: var(--shadow-md);
        
        transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    /* Mostrar el texto "Contactame" al pasar el mouse sobre el *contenedor* */
    .whatsapp-container:hover .whatsapp-tooltip {
        visibility: visible;
        opacity: 1;
    }
    /* === FIN DE ESTILOS PARA WHATSAPP === */
  </style>
  <style>
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:50}
    .modal-backdrop.active{display:flex}
    .modal{background:#0b1220;color:#fff;border:1px solid rgba(255,255,255,.12);border-radius:12px;max-width:560px;width:calc(100% - 32px);padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .modal .title{font-weight:600;font-size:18px}
    .modal .content{margin-top:8px;color:#cbd5e1}
    .modal .actions{margin-top:12px;display:flex;justify-content:flex-end;gap:8px}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:#111827;color:#fff;text-decoration:none}
    .btn.primary{background:var(--primary);color:var(--text-on-primary)}
  </style>
</head>
<body>
  <main class="screen">
    <section class="selector-wrapper">
      <div class="card" style="margin-bottom:16px;">
        <div class="brand">
          <img src="{{ logo_url }}" alt="Logo del gimnasio" />
          <div>
            <h1 id="brand-title">{{ gym_name }}</h1>
            <p class="muted" aria-describedby="brand-title">Portal de acceso para clientes, dueño y profesores.</p>
          </div>
        </div>
        <div class="grid">
          <div class="option-card" data-href="/login" aria-labelledby="opt-dashboard-title" aria-describedby="opt-dashboard-desc">
            <div>
              <span class="option-icon" aria-hidden="true"><i class="bi bi-graph-up"></i></span>
              <span id="opt-dashboard-title" class="option-title">Dashboard</span>
              <span class="role-chip" aria-label="Rol sugerido">Dueño</span>
            </div>
            <p id="opt-dashboard-desc" class="desc">Ingresa al panel con KPIs, reportes y control del sistema.</p>
            <div class="actions">
              <a class="btn success" href="/login" aria-label="Ir al login del dueño">Ir al login</a>
            </div>
          </div>
          <div class="option-card" data-href="/checkin" aria-labelledby="opt-checkin-title" aria-describedby="opt-checkin-desc">
            <div>
              <span class="option-icon" aria-hidden="true"><i class="bi bi-qr-code-scan"></i></span>
              <span id="opt-checkin-title" class="option-title">Check-in</span>
              <span class="role-chip" aria-label="Rol sugerido">Socio</span>
            </div>
            <p id="opt-checkin-desc" class="desc">Valida tu asistencia escaneando un QR o ingresando el token.</p>
            <div class="actions">
              <a class="btn checkin-cta" href="/checkin" aria-label="Ir al check-in">Ir al check-in</a>
            </div>
          </div>
          <div class="option-card" data-href="/usuario/login" aria-labelledby="opt-usuarios-title" aria-describedby="opt-usuarios-desc">
            <div>
              <span class="option-icon" aria-hidden="true"><i class="bi bi-person-badge"></i></span>
              <span id="opt-usuarios-title" class="option-title">Usuarios</span>
              <span class="role-chip" aria-label="Rol sugerido">Socio</span>
            </div>
            <p id="opt-usuarios-desc" class="desc">Accede a tu panel: vencimientos, pagos, rutinas y QR.</p>
            <div class="actions">
              <a class="btn" href="/usuario/login" aria-label="Ir al login de Usuarios">Ir a Usuarios</a>
            </div>
          </div>
  <div class="option-card" data-href="/gestion/login" aria-labelledby="opt-gestion-title" aria-describedby="opt-gestion-desc">
            <div>
              <span class="option-icon" aria-hidden="true"><i class="bi bi-people"></i></span>
              <span id="opt-gestion-title" class="option-title">Gestión</span>
              <span class="role-chip" aria-label="Rol sugerido">Dueño/Profesor</span>
            </div>
            <p id="opt-gestion-desc" class="desc">Administra usuarios y pagos desde la web.</p>
            <div class="actions">
              <a class="btn tertiary" href="/gestion/login" aria-label="Ir al login de Gestión">Ir a Gestión</a>
            </div>
          </div>
        </div>
      </div>
      <footer class="card" aria-label="Accesos rápidos" style="text-align:center;">
          
          <div class="links">
            <a href="/checkin">Check-in</a>
            <span class="muted">•</span>
            <a href="/gestion/login">Gestión</a>
            <span class="muted">•</span>
            <a href="/usuario/login">Usuarios</a>
            <span class="muted">•</span>
            <a href="/login">Dashboard</a>
          </div>

          <p style="margin-top: 15px; font-size: 0.9rem; color: #555;">
              Gym Management System - Powered by MotionA - 2025. Todos los derechos reservados.
          </p>
      </footer>
    </section>
  </main>
  <script>
    // Hacer toda la tarjeta clicable y accesible con teclado
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.option-card[data-href]').forEach(card => {
        const href = card.getAttribute('data-href');
        if (!href) return;
        card.addEventListener('click', (e) => {
          // Si el click fue en un enlace interno, no duplicar navegación
          if (e.target && e.target.closest('a')) return;
          window.location.href = href;
        });
        card.setAttribute('role', 'link');
        card.setAttribute('tabindex', '0');
        card.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            window.location.href = href;
          }
        });
      });
    });
  </script>

  <div class="whatsapp-container">
      <!-- Botón de WhatsApp --> <!-- El link se reemplaza al toque por si se quiere cambiar el mensaje-->
      <a href="https://wa.me/5493434473599?text=Hola,%20quiero%20más%20información%20sobre%20Gym%20Management%20System%20de%20MotionA" 
         target="_blank" 
         class="floating-whatsapp-btn" 
         aria-label="Contactar por WhatsApp">
          
          <i class="fab fa-whatsapp"></i>
      </a>
      
      <span class="whatsapp-tooltip">Contactame</span>
  </div>
  <div class="modal-backdrop" id="maintenance-modal">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="maint-title">
      <div class="title" id="maint-title">Mantenimiento</div>
      <div class="content" id="maint-msg"></div>
      <div class="actions">
        <button class="btn" id="maint-close">Cerrar</button>
      </div>
    </div>
  </div>
  <div class="modal-backdrop" id="suspension-modal" data-locked="1" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="susp-title">
      <div class="title" id="susp-title">Servicio suspendido</div>
      <div class="content" id="susp-msg"></div>
    </div>
  </div>
  <script>
    (function(){
      function showMaintenance(msg){
        var b=document.getElementById('maintenance-modal');
        var m=document.getElementById('maint-msg');
        if(!b||!m)return; m.textContent=String(msg||'Mantenimiento en curso'); b.classList.add('active');
      }
      function hideMaintenance(){ var b=document.getElementById('maintenance-modal'); if(b) b.classList.remove('active'); }
      try{ var c=document.getElementById('maint-close'); if(c){ c.addEventListener('click', hideMaintenance); } }catch(_){ }
      try{
        fetch('/api/maintenance_status',{credentials:'same-origin'}).then(function(r){ if(!r.ok) return null; return r.json(); }).then(function(d){ if(!d) return; if(d.active){ showMaintenance(d.message); } });
      }catch(_){ }
      try{
        fetch('/api/suspension_status',{credentials:'same-origin'}).then(function(r){ if(!r.ok) return null; return r.json(); }).then(function(d){ if(!d) return; if(d.suspended){ var b=document.getElementById('suspension-modal'); var m=document.getElementById('susp-msg'); if(!b||!m) return; var motivo=String(d.reason||'Servicio suspendido'); var hasta=String(d.until||''); var msg=motivo; if(hasta){ msg += ' Hasta: ' + hasta; } m.textContent=msg; b.classList.add('active'); b.removeAttribute('aria-hidden'); } });
      }catch(_){ }
    })();
  </script>
</body>
</html>

<!-- Actualización dinámica de nombre del gimnasio en toda la webapp -->
<script>
(function(){
  function applyBranding(j){
    var name = j && typeof j.gym_name === 'string' ? j.gym_name.trim() : '';
    if(!name) return;
    try {
      var t = document.title || '';
      var prefix = t.includes('•') ? t.split('•')[0].trim() : t.trim();
      if (prefix) document.title = prefix + ' • ' + name;
    } catch(_){}
    var candidates = [
      document.getElementById('brand-title'),
      document.getElementById('login-title'),
      document.querySelector('.brand h1'),
      document.querySelector('.brand strong')
    ];
    for (var i=0;i<candidates.length;i++){ if (candidates[i]) { candidates[i].textContent = name; break; } }
  }
  async function fetchBranding(){ 
    try { 
      var r = await fetch('/api/gym/data', { headers: { 'Accept': 'application/json' } });
      var j = await r.json(); 
      applyBranding(j); 
    } catch(_){ /* noop */ }
  }
  window.addEventListener('DOMContentLoaded', fetchBranding);
  window.addEventListener('storage', function(e){ 
    if (e && e.key === 'gym_branding_update' && e.newValue){ 
      try { var payload = JSON.parse(e.newValue); if (payload && payload.gym_name) applyBranding({ gym_name: payload.gym_name }); } catch(_){ /* noop */ } 
    } 
  });
  window.addEventListener('gym-branding-updated', function(ev){ 
    try { var d = ev && ev.detail ? ev.detail : null; if (d && d.gym_name) applyBranding({ gym_name: d.gym_name }); } catch(_){ /* noop */ }
  });
})();
</script>