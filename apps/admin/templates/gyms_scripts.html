<script>
function openDetails3(gid){
  var detailsOverlay=document.getElementById('details-overlay');
  var detailsContent=document.getElementById('details-content');
  var detailsClose=document.getElementById('details-close');
  if(!detailsOverlay||!detailsContent)return;
  detailsOverlay.classList.remove('hidden');
  document.body.classList.add('overflow-hidden');
  try{var url=new URL(window.location.href);url.searchParams.set('modal','details');url.searchParams.set('gid',String(gid||''));history.pushState({},'',url.toString())}catch(_){ }
  setTimeout(function(){if(detailsClose){detailsClose.focus()}},10);
  detailsContent.innerHTML='<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px"><div class="skeleton h-24 rounded-md"></div><div class="skeleton h-24 rounded-md"></div><div class="skeleton h-24 rounded-md"></div></div>';
  fetch((window.apiPref?window.apiPref():'')+'/admin/gyms/'+gid+'/details',{headers:{'accept':'application/json'}}).then(function(r){return r.json()}).then(function(j){
    var d=(j&&j.gym)||{};var h=(j&&j.health)||{};var pays=(j&&j.payments)||[];var sub=(j&&j.subscription)||{};var wurl=String((j&&j.webapp_url)||'');
    var dbo=!!(h&&h.db&&h.db.ok);var wao=!!(h&&h.whatsapp&&h.whatsapp.ok);var sto=!!(h&&h.storage&&h.storage.ok);
    var healthHtml='<div class="flex items-center gap-2"><div class="flex items-center gap-2"><span class="w-6 h-6 rounded-full '+(dbo?'bg-green-600':'bg-red-600')+'"></span><span class="text-gray-300 text-xs">DB</span></div><div class="flex items-center gap-2"><span class="w-6 h-6 rounded-full '+(wao?'bg-green-600':'bg-red-600')+'"></span><span class="text-gray-300 text-xs">WA</span></div><div class="flex items-center gap-2"><span class="w-6 h-6 rounded-full '+(sto?'bg-green-600':'bg-red-600')+'"></span><span class="text-gray-300 text-xs">ST</span></div></div>';
    var dh=document.getElementById('details-health');if(dh){dh.innerHTML=healthHtml}
    var html='';html+='<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px">';
    html+='<div class="grid gap-4">';html+='<div class="bg-gray-800 p-3 rounded-md"><div class="font-semibold text-white">Información Básica</div><div class="grid grid-cols-2 gap-2 mt-2">';html+='<div class="text-gray-400">ID</div><div>'+String(d.id||'')+'</div>';html+='<div class="text-gray-400">Nombre</div><div>'+String(d.nombre||'')+'</div>';html+='<div class="text-gray-400">Subdominio</div><div>'+String(d.subdominio||'')+'</div>';html+='<div class="text-gray-400">Estado</div><div>'+String(d.status||'')+'</div>';html+='<div class="text-gray-400">Creado</div><div>'+String(d.created_at||'')+'</div>';html+='<div class="text-gray-400">Teléfono</div><div>'+String(d.owner_phone||'')+'</div>';html+='<div class="text-gray-400">DB</div><div>'+String(d.db_name||'')+'</div>';html+='</div></div>';html+='<div class="bg-gray-800 p-3 rounded-md"><div class="font-semibold text-white">Almacenamiento</div><div class="grid grid-cols-2 gap-2 mt-2">';html+='<div class="text-gray-400">Carpeta en bucket</div><div>'+String(d.assets_folder_prefix||'')+'</div>';html+='<div class="text-gray-400">CDN base</div><div>'+String(d.storage_public_base||'')+'</div>';html+='</div></div>';html+='</div>';
    html+='<div class="grid gap-4">';html+='<div class="bg-gray-800 p-3 rounded-md"><div class="font-semibold text-white">Suscripción</div><div class="mt-2 text-sm">Plan: '+String(sub.plan||'')+' · Válido hasta: '+String(sub.valid_until||'')+'</div></div>';html+='<div class="bg-gray-800 p-3 rounded-md"><div class="font-semibold text-white">Pagos recientes</div>';if(pays.length){html+='<div class="mt-2 grid gap-1">';for(var i=0;i<Math.min(pays.length,5);i++){var p=pays[i];html+='<div class="flex justify-between text-sm"><span>'+(String(p.plan||'')+' · '+String(p.amount||'')+' '+String(p.currency||''))+'</span><span class="text-gray-400">'+String(p.paid_at||'')+'</span></div>'}html+='</div>'}else{html+='<div class="mt-2 text-gray-400 text-sm">Sin pagos</div>'}html+='</div>';html+='</div>';
    if(wurl){html+='<div class="grid gap-4"><div class="bg-gray-800 p-3 rounded-md"><div class="font-semibold text-white">Vista previa</div><div class="mt-2 rounded-md border border-gray-800 overflow-hidden"><iframe src="'+wurl+'" title="Vista previa webapp" class="w-full h-[70vh] bg-black"></iframe></div></div></div>'}
    detailsContent.innerHTML=html
  }).catch(function(){detailsContent.innerHTML='<div class="text-red-600">Error al cargar detalles</div>'})
}
function openDetails2(gid){openDetails3(gid)}

(function(){
  var toast = window.toast || function(){};
  var selected=new Set();function updateSel(){var c=document.getElementById('sel-count');if(c){c.textContent=String(selected.size)}var hid=document.getElementById('selected-ids');if(hid){hid.value=Array.from(selected).join(',')}}
  var boxes=document.querySelectorAll('.select-gym');for(var i=0;i<boxes.length;i++){boxes[i].addEventListener('change',function(){var v=this.value;if(this.checked){selected.add(v)}else{selected.delete(v)}updateSel()})}
  function selectAll(){var boxes=document.querySelectorAll('.select-gym');selected.clear();for(var i=0;i<boxes.length;i++){boxes[i].checked=true;selected.add(boxes[i].value)}updateSel()}
  function clearSel(){var boxes=document.querySelectorAll('.select-gym');for(var i=0;i<boxes.length;i++){boxes[i].checked=false}selected.clear();updateSel()}
  var bsa=document.getElementById('batch-select-all');if(bsa){bsa.addEventListener('click',selectAll)}var bcl=document.getElementById('batch-clear');if(bcl){bcl.addEventListener('click',clearSel)}
  var subs=document.querySelectorAll('[data-sub]');for(var j=0;j<subs.length;j++){subs[j].addEventListener('click',function(){var tx=this.getAttribute('data-sub')||'';if(navigator.clipboard&&navigator.clipboard.writeText){navigator.clipboard.writeText(tx).then(function(){toast('Copiado: '+tx,'info')}).catch(function(){toast('No se pudo copiar','error')})}else{toast(tx,'info')}})}
  var _pref='';
  function runBatch(action){if(selected.size===0){toast('No hay seleccionados','info');return}var form=new URLSearchParams();form.append('action',action);form.append('gym_ids',Array.from(selected).join(','));var pref=(window.apiPref?window.apiPref():'');return fetch(pref+'/admin/gyms/batch',{method:'POST',headers:{'accept':'application/json','content-type':'application/x-www-form-urlencoded'},body:form.toString()}).then(function(r){return r.json().then(function(j){return {ok:r.ok,body:j}})}).then(function(res){if(res.ok&&res.body&&res.body.ok){toast('Acción '+action+' aplicada','success');refreshGymsList()}else{toast('Error en lote','error')}}).catch(function(){toast('Error de red','error')})}
  function runRemindBatch(){if(selected.size===0){toast('No hay seleccionados','info');return}var msgEl=document.getElementById('batch-message');var form=new URLSearchParams();form.append('gym_ids',Array.from(selected).join(','));form.append('message',msgEl?String(msgEl.value||''):'');var pref=(window.apiPref?window.apiPref():'');return fetch(pref+'/admin/gyms/remind/batch',{method:'POST',headers:{'accept':'application/json','content-type':'application/x-www-form-urlencoded'},body:form.toString()}).then(function(r){return r.json().then(function(j){return {ok:r.ok,body:j}})}).then(function(res){if(res.ok&&res.body&&res.body.ok){var results=Array.isArray(res.body.results)?res.body.results:[];var okc=results.filter(function(x){return !!x&&!!x.ok}).length;var fail=results.length-okc;toast('Recordatorios enviados: '+okc+' · Fallidos: '+fail,'success');refreshGymsList()}else{var msg=(res&&res.body&&res.body.error)?String(res.body.error):'Error al enviar recordatorios';toast(msg,'error')}}).catch(function(){toast('Error de red','error')})}
  function runRemindClearBatch(){if(selected.size===0){toast('No hay seleccionados','info');return}var form=new URLSearchParams();form.append('gym_ids',Array.from(selected).join(','));var pref=(window.apiPref?window.apiPref():'');return fetch(pref+'/admin/gyms/remind/clear/batch',{method:'POST',headers:{'accept':'application/json','content-type':'application/x-www-form-urlencoded'},body:form.toString()}).then(function(r){return r.json().then(function(j){return {ok:r.ok,body:j}})}).then(function(res){if(res.ok&&res.body&&res.body.ok){var results=Array.isArray(res.body.results)?res.body.results:[];var okc=results.filter(function(x){return !!x&&!!x.ok}).length;var fail=results.length-okc;toast('Recordatorios quitados: '+okc+' · Fallidos: '+fail,'success');refreshGymsList()}else{var msg=(res&&res.body&&res.body.error)?String(res.body.error):'Error al quitar recordatorios';toast(msg,'error')}}).catch(function(){toast('Error de red','error')})}
  function runMaintBatch(){if(selected.size===0){toast('No hay seleccionados','info');return}var msgEl=document.getElementById('batch-maint-message');var form=new URLSearchParams();form.append('gym_ids',Array.from(selected).join(','));form.append('message',msgEl?String(msgEl.value||''):'');var pref=(window.apiPref?window.apiPref():'');return fetch(pref+'/admin/gyms/maintenance/notify/batch',{method:'POST',headers:{'accept':'application/json','content-type':'application/x-www-form-urlencoded'},body:form.toString()}).then(function(r){return r.json().then(function(j){return {ok:r.ok,body:j}})}).then(function(res){if(res.ok&&res.body&&res.body.ok){var results=Array.isArray(res.body.results)?res.body.results:[];var okc=results.filter(function(x){return !!x&&!!x.ok}).length;var fail=results.length-okc;toast('Avisos de mantenimiento enviados: '+okc+' · Fallidos: '+fail,'success');refreshGymsList()}else{var msg=(res&&res.body&&res.body.error)?String(res.body.error):'Error al enviar avisos';toast(msg,'error')}}).catch(function(){toast('Error de red','error')})}
  function withBtn(btn,fn){if(!btn)return;btn.setAttribute('disabled','disabled');var p=null;try{p=fn()}catch(_){ }if(p&&p.finally){p.finally(function(){btn.removeAttribute('disabled')})}else{btn.removeAttribute('disabled')}}
  function openDetails(gid){openDetails3(gid)}
  function haloDue(){var cards=document.querySelectorAll('[data-next-due]');var now=new Date();for(var i=0;i<cards.length;i++){var nd=cards[i].getAttribute('data-next-due')||'';if(!nd)continue;var d=new Date(nd);if(isNaN(d.getTime()))continue;var diff=Math.round((d.getTime()-now.getTime())/86400000);if(diff<=3){cards[i].classList.remove('border-gray-800');cards[i].classList.add('border-red-600')}else if(diff<=7){cards[i].classList.remove('border-gray-800');cards[i].classList.add('border-yellow-500')}}}
  haloDue()
  var createOverlay=document.getElementById('create-modal');var createOpen=document.getElementById('open-create');var createOpen2=document.getElementById('open-create-2');var createCancel=document.getElementById('create-cancel');var createCancel2=document.getElementById('create-cancel-2');function openCreate(){if(createOverlay){createOverlay.classList.remove('hidden');document.body.classList.add('overflow-hidden');var nm=document.querySelector('#create-modal [name="nombre"]');if(nm){setTimeout(function(){nm.focus()},10)}}}function closeCreate(){if(createOverlay){createOverlay.classList.add('hidden');document.body.classList.remove('overflow-hidden')}}if(createOpen){createOpen.addEventListener('click',openCreate)}if(createOpen2){createOpen2.addEventListener('click',openCreate)}if(createCancel){createCancel.addEventListener('click',closeCreate)}if(createCancel2){createCancel2.addEventListener('click',closeCreate)}if(createOverlay){createOverlay.addEventListener('click',function(e){if(e.target===createOverlay){closeCreate()}})}
  var detailsOverlay=document.getElementById('details-overlay');
  var detailsClose=document.getElementById('details-close');
  if(detailsClose){detailsClose.addEventListener('click',function(){if(detailsOverlay){detailsOverlay.classList.add('hidden');document.body.classList.remove('overflow-hidden');try{var u=new URL(window.location.href);u.searchParams.delete('modal');u.searchParams.delete('gid');history.pushState({},'',u.toString())}catch(_){}}})}
  var od=document.querySelectorAll('[data-open-details]');for(var i=0;i<od.length;i++){od[i].addEventListener('click',function(){var gid=this.getAttribute('data-open-details');openDetails3(gid)})}
  var suspendOverlay=document.getElementById('suspend-modal');var suspendCancel=document.getElementById('suspend-cancel');var suspendCancel2=document.getElementById('suspend-cancel-2');var suspendYes=document.getElementById('suspend-yes');var suspendReason=document.getElementById('suspend-reason');var suspendUntil=document.getElementById('suspend-until');var suspendHard=document.getElementById('suspend-hard');var suspendGymId=null;function openSuspend(gid){suspendGymId=gid;if(suspendOverlay){suspendOverlay.classList.remove('hidden');document.body.classList.add('overflow-hidden');if(suspendReason){setTimeout(function(){suspendReason.focus()},10)}}}function closeSuspend(){suspendGymId=null;if(suspendOverlay){suspendOverlay.classList.add('hidden');document.body.classList.remove('overflow-hidden')}}function submitSuspend(){if(!suspendGymId){closeSuspend();return}var form=new URLSearchParams();form.append('reason',String(suspendReason.value||''));form.append('until',String(suspendUntil.value||''));form.append('hard',suspendHard.checked?'true':'false');var pref=(window.apiPref?window.apiPref():'');fetch(pref+'/admin/gyms/'+suspendGymId+'/suspend',{method:'POST',headers:{'accept':'application/json','content-type':'application/x-www-form-urlencoded'},body:form.toString()}).then(function(r){return r.json().then(function(j){return {ok:r.ok,body:j}})}).then(function(res){if(res.ok&&res.body&&res.body.ok){toast('Gimnasio suspendido','success');refreshGymUI(suspendGymId);refreshHealth(suspendGymId)}else{toast('Error al suspender','error')}}).catch(function(){toast('Error de red','error')}).finally(function(){closeSuspend()})}
  if(suspendCancel){suspendCancel.addEventListener('click',closeSuspend)}if(suspendCancel2){suspendCancel2.addEventListener('click',closeSuspend)}if(suspendYes){suspendYes.addEventListener('click',submitSuspend)}var os=document.querySelectorAll('[data-open-suspend]');for(var i=0;i<os.length;i++){os[i].addEventListener('click',function(){var gid=this.getAttribute('data-open-suspend');openSuspend(gid)})}
  var bp=document.getElementById('batch-prov');if(bp){bp.addEventListener('click',function(){var self=this;var f=function(){withBtn(self,function(){return runBatch('provision')})};if(window.confirmAction){window.confirmAction('¿Provisionar seleccionados?',f)}else{f()}})}
  var bs=document.getElementById('batch-sus');if(bs){bs.addEventListener('click',function(){var self=this;var f=function(){withBtn(self,function(){return runBatch('suspend')})};if(window.confirmAction){window.confirmAction('¿Suspender seleccionados?',f)}else{f()}})}
  var bu=document.getElementById('batch-uns');if(bu){bu.addEventListener('click',function(){var self=this;var f=function(){withBtn(self,function(){return runBatch('unsuspend')})};if(window.confirmAction){window.confirmAction('¿Reactivar seleccionados?',f)}else{f()}})}
  var br=document.getElementById('batch-remind');if(br){br.addEventListener('click',function(){var self=this;var f=function(){withBtn(self,function(){return runRemindBatch()})};if(window.confirmAction){window.confirmAction('¿Enviar recordatorio?',f)}else{f()}})}
  var brc=document.getElementById('batch-remind-clear');if(brc){brc.addEventListener('click',function(){var self=this;var f=function(){withBtn(self,function(){return runRemindClearBatch()})};if(window.confirmAction){window.confirmAction('¿Quitar recordatorio?',f)}else{f()}})}
  var bm=document.getElementById('batch-maint');if(bm){bm.addEventListener('click',function(){var self=this;var f=function(){withBtn(self,function(){return runMaintBatch()})};if(window.confirmAction){window.confirmAction('¿Enviar aviso de mantenimiento?',f)}else{f()}})}
  var ok=document.getElementById('open-k');var okf=document.getElementById('open-k-float');
  if(ok){ok.addEventListener('click',function(){if(window.openGlobalK){window.openGlobalK()}})}
  if(okf){okf.addEventListener('click',function(){if(window.openGlobalK){window.openGlobalK()}})}
  function refreshHealth(gid){var mini=document.getElementById('health-mini-'+gid);var pref=(window.apiPref?window.apiPref():'');if(mini){fetch(pref+'/admin/gyms/'+gid+'/health?snippet=1',{headers:{'accept':'text/html'}}).then(function(r){return r.text()}).then(function(html){mini.innerHTML=html}).catch(function(){})}var full=document.getElementById('health-'+gid);if(full){fetch(pref+'/admin/gyms/'+gid+'/health?snippet=1',{headers:{'accept':'text/html'}}).then(function(r){return r.text()}).then(function(html){full.innerHTML=html}).catch(function(){})}
  }
  function refreshGymUI(gid){var pref=(window.apiPref?window.apiPref():'');fetch(pref+'/admin/gyms/'+gid+'/details',{headers:{'accept':'application/json'}}).then(function(r){return r.json()}).then(function(j){var d=(j&&j.gym)||{};var nameEl=document.getElementById('gym-name-'+gid);if(nameEl){nameEl.textContent=String(d.nombre||'')}var subBtn=document.getElementById('gym-sub-'+gid);if(subBtn){subBtn.textContent=String(d.subdominio||'');subBtn.setAttribute('data-sub',String(d.subdominio||''))}var urlEl=document.getElementById('gym-url-'+gid);if(urlEl){var w=String((j&&j.webapp_url)||'');if(w){urlEl.textContent=w;urlEl.setAttribute('href',w);urlEl.style.display=''}else{urlEl.textContent='';urlEl.removeAttribute('href');urlEl.style.display='none'}}var fEl=document.getElementById('gym-folder-'+gid);if(fEl){fEl.textContent=String(d.assets_folder_prefix||'')}var st=document.getElementById('status-badge-'+gid);if(st){var s=String(d.status||'');st.textContent=s;st.className='px-2 py-1 rounded-full text-xs '+(s==='active'?'bg-green-600 text-white':(s==='suspended'?'bg-red-600 text-white':(s==='maintenance'?'bg-yellow-500 text-black':'bg-gray-700 text-white')))}var rn=document.getElementById('row-name-'+gid);if(rn){rn.textContent=String(d.nombre||'')}var rs=document.getElementById('row-sub-'+gid);if(rs){rs.textContent=String(d.subdominio||'')}var rurl=document.getElementById('row-url-'+gid);if(rurl){var w2=String((j&&j.webapp_url)||'');if(w2){rurl.textContent=w2;rurl.setAttribute('href',w2);rurl.style.display=''}else{rurl.textContent='';rurl.removeAttribute('href');rurl.style.display='none'}}}).catch(function(){})}
  function refreshGymsList(){var url=new URL(window.location.href);url.searchParams.set('ui','1');url.searchParams.set('snippet','1');fetch(url.toString(),{headers:{'accept':'text/html'}}).then(function(r){return r.text()}).then(function(html){try{var doc=new DOMParser().parseFromString(html,'text/html');var next=doc.querySelector('#gyms-section');var cur=document.querySelector('#gyms-section');if(next&&cur){cur.innerHTML=next.innerHTML;rebindGymsInteractions();haloDue()}}catch(_){}}).catch(function(){})}
  function rebindGymsInteractions(){
    var boxes=document.querySelectorAll('.select-gym');
    for(var i=0;i<boxes.length;i++){
      boxes[i].addEventListener('change',function(){
        var v=this.value;
        if(this.checked){selected.add(v)}else{selected.delete(v)}
        updateSel()
      })
    }
    var od=document.querySelectorAll('[data-open-details]');
    for(var j=0;j<od.length;j++){
      od[j].addEventListener('click',function(){
        var gid=this.getAttribute('data-open-details');
        openDetails3(gid)
      })
    }
    var bp=document.getElementById('batch-prov');
    if(bp){bp.addEventListener('click',function(){var self=this;var f=function(){withBtn(self,function(){return runBatch('provision')})};if(window.confirmAction){window.confirmAction('¿Provisionar seleccionados?',f)}else{f()}})}
    var bs=document.getElementById('batch-sus');
    if(bs){bs.addEventListener('click',function(){var self=this;var f=function(){withBtn(self,function(){return runBatch('suspend')})};if(window.confirmAction){window.confirmAction('¿Suspender seleccionados?',f)}else{f()}})}
    var bu=document.getElementById('batch-uns');
    if(bu){bu.addEventListener('click',function(){var self=this;var f=function(){withBtn(self,function(){return runBatch('unsuspend')})};if(window.confirmAction){window.confirmAction('¿Reactivar seleccionados?',f)}else{f()}})}
    var br=document.getElementById('batch-remind');
    if(br){br.addEventListener('click',function(){var self=this;var f=function(){withBtn(self,function(){return runRemindBatch()})};if(window.confirmAction){window.confirmAction('¿Enviar recordatorio?',f)}else{f()}})}
    var bm=document.getElementById('batch-maint');
    if(bm){bm.addEventListener('click',function(){var self=this;var f=function(){withBtn(self,function(){return runMaintBatch()})};if(window.confirmAction){window.confirmAction('¿Enviar aviso de mantenimiento?',f)}else{f()}})}
    try{
      var pref='';
      var cards=document.querySelectorAll('[data-gym-id]');
      for(var i=0;i<cards.length;i++){
        var gid=String(cards[i].getAttribute('data-gym-id')||'');
        if(!gid)continue;
        var nId='edit-name-'+gid;
        var sId='edit-sub-'+gid;
        var stId='edit-sub-status-'+gid;
        var bId='edit-folder-preview-'+gid;
        if(window.bindSubdomainBucket){window.bindSubdomainBucket(nId,sId,stId,bId,pref)}
      }
      var rows=document.querySelectorAll('tr[data-gym-id]');
      for(var j=0;j<rows.length;j++){
        var rgid=String(rows[j].getAttribute('data-gym-id')||'');
        if(!rgid)continue;
        var tnId='t-name-'+rgid;
        var tsId='t-sub-'+rgid;
        var tstId='t-sub-status-'+rgid;
        var tbId='t-folder-preview-'+rgid;
        if(window.bindSubdomainBucket){window.bindSubdomainBucket(tnId,tsId,tstId,tbId,pref)}
      }
      var cName=document.getElementById('create-name');
      var cSub=document.getElementById('create-sub');
      
    }catch(_){}
  }
  document.body.addEventListener('htmx:afterOnLoad',function(evt){try{var xhr=evt.detail.xhr;var ct=(xhr&&xhr.getResponseHeader)?(xhr.getResponseHeader('content-type')||''):'';if(ct.indexOf('application/json')===-1){return}var txt=xhr&&xhr.responseText||'';var j=null;try{j=JSON.parse(txt)}catch(_){j=null}var el=evt.target;var act=el&&el.getAttribute('action')||el&&el.getAttribute('hx-post')||'';if(j&&j.ok){if(act==='/admin/gyms'){toast('Gimnasio creado','success');closeCreate();refreshGymsList()}else{var m=act.match(/\/admin\/gyms\/(\d+)(\/\w+)?/);if(m&&m[1]){var gid=m[1];toast('Guardado','success');var op=m[2]||'';if(op.indexOf('/update')===0){refreshGymsList()}else{refreshGymUI(gid);refreshHealth(gid)}}else{toast('Guardado','success')}}}else{toast('Error','error')}}catch(_){}});
  if(inp){inp.addEventListener('input',function(){searchK(inp.value)})}
  document.addEventListener('keydown',function(e){if(e.key==='Escape'){var det=document.getElementById('details-overlay');if(det&&!det.classList.contains('hidden')){var dc=document.getElementById('details-close');if(dc){dc.click()}}if(createOverlay&&!createOverlay.classList.contains('hidden')){var cc=document.getElementById('create-cancel');if(cc){cc.click()}}if(suspendOverlay&&!suspendOverlay.classList.contains('hidden')){var sc=document.getElementById('suspend-cancel');if(sc){sc.click()}}}});
  try{var u=new URL(window.location.href);var m=u.searchParams.get('modal')||'';var gid=u.searchParams.get('gid')||'';if(m==='details'&&gid){openDetails3(gid)}window.addEventListener('popstate',function(){try{var u2=new URL(window.location.href);var m2=u2.searchParams.get('modal')||'';var gid2=u2.searchParams.get('gid')||'';var det=document.getElementById('details-overlay');if(m2==='details'&&gid2){openDetails3(gid2)}else{if(det){det.classList.add('hidden');document.body.classList.remove('overflow-hidden')}}}catch(_){}})}catch(_){}
  document.addEventListener('keydown',function(e){var k=e.key.toLowerCase();if((e.ctrlKey||e.metaKey)&&k==='k'){var o=document.getElementById('global-open-k');if(o){e.preventDefault();o.click();return}}if(k==='['){var link=document.getElementById('prev-link');if(link){link.click()}}if(k===']'){var link2=document.getElementById('next-link');if(link2){link2.click()}}if(k==='a'){e.preventDefault();var bsa=document.getElementById('batch-select-all');if(bsa){bsa.click()}}if(k==='c'){e.preventDefault();var bcl=document.getElementById('batch-clear');if(bcl){bcl.click()}}if(k==='r'){e.preventDefault();var br=document.getElementById('batch-remind');if(br){br.click()}}if(k==='p'){e.preventDefault();var bp=document.getElementById('batch-prov');if(bp){bp.click()}}if(k==='s'){e.preventDefault();var bs=document.getElementById('batch-sus');if(bs){bs.click()}}if(k==='u'){e.preventDefault();var bu=document.getElementById('batch-uns');if(bu){bu.click()}}if(k==='m'){e.preventDefault();var bm=document.getElementById('batch-maint');if(bm){bm.click()}}});
  
  // Logic from top of gyms.html
  var o=document.getElementById('open-actions');var ov=document.getElementById('actions-overlay');var c=document.getElementById('actions-close');var ab=document.getElementById('actions-backdrop');function open(){if(ov){ov.classList.remove('hidden');document.body.classList.add('overflow-hidden');setTimeout(function(){if(c){c.focus()}},10)}}function close(){if(ov){ov.classList.add('hidden');document.body.classList.remove('overflow-hidden')}}if(o){o.addEventListener('click',open)}if(c){c.addEventListener('click',close)}if(ab){ab.addEventListener('click',close)}document.addEventListener('keydown',function(e){if(e.key==='Escape'){close()}});var ocq=document.getElementById('open-create-quick');if(ocq){ocq.addEventListener('click',function(){close();var btn=document.getElementById('open-create');if(btn){btn.click()}})}function proxy(id,fn){var b=document.getElementById(id);if(b){b.addEventListener('click',fn)}}proxy('batch-prov-side',function(){document.getElementById('batch-prov').click()});proxy('batch-uns-side',function(){document.getElementById('batch-uns').click()});proxy('batch-sus-side',function(){document.getElementById('batch-sus').click()});proxy('batch-remind-side',function(){var src=document.getElementById('batch-message');var dst=document.getElementById('batch-message-side');if(src&&dst){src.value=dst.value}document.getElementById('batch-remind').click()});proxy('batch-maint-side',function(){var src=document.getElementById('batch-maint-message');var dst=document.getElementById('batch-maint-message-side');if(src&&dst){src.value=dst.value}document.getElementById('batch-maint').click()});
})();
</script>
