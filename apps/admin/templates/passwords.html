{% extends "base.html" %}
{% set _ = '' %}
{% block content %}
<div id="passwords-section" class="max-w-xl mx-auto space-y-4">
  <div class="flex items-center justify-between">
    <h1 class="text-2xl font-semibold">{% if mode=='owner' %}Contraseña de dueño{% else %}Cambiar contraseña Admin{% endif %}</h1>
    <a href="/admin/" class="px-3 py-2 rounded-md bg-gray-900"><i class="fa-solid fa-house"></i><span class="ml-2">Inicio</span></a>
  </div>
  {% if mode=='owner' %}
  <div class="text-gray-400">Gimnasio: {{ sub }}</div>
  <form hx-post="/admin/gyms/{{ gid }}/owner" hx-headers='{"accept":"application/json"}' hx-swap="none" class="grid gap-3">
    <label for="owner-new" class="text-sm text-gray-300">Nueva contraseña</label>
    <input id="owner-new" type="password" name="new_password" required oninput="var c=this.form.querySelector('[name=confirm_password]');if(c){c.setCustomValidity(c.value!==this.value?'Las contraseñas no coinciden':'')}" class="px-3 py-2 rounded-md border border-gray-700 bg-gray-950" />
    <label for="owner-confirm" class="text-sm text-gray-300">Confirmar contraseña</label>
    <input id="owner-confirm" type="password" name="confirm_password" required oninput="this.setCustomValidity(this.value!==this.form.querySelector('[name=new_password]').value?'Las contraseñas no coinciden':'')" class="px-3 py-2 rounded-md border border-gray-700 bg-gray-950" />
    <button type="submit" class="px-3 py-2 rounded-md bg-primary text-primary-foreground">Guardar</button>
  </form>
  {% else %}
  <form hx-post="/admin/owner/password" hx-headers='{"accept":"application/json"}' hx-swap="none" class="grid gap-3">
    <label for="admin-current" class="text-sm text-gray-300">Contraseña actual</label>
    <input id="admin-current" type="password" name="current_password" required class="px-3 py-2 rounded-md border border-gray-700 bg-gray-950" />
    <label for="admin-new" class="text-sm text-gray-300">Nueva contraseña</label>
    <input id="admin-new" type="password" name="new_password" required oninput="var c=this.form.querySelector('[name=confirm_password]');if(c){c.setCustomValidity(c.value!==this.value?'Las contraseñas no coinciden':'')}" class="px-3 py-2 rounded-md border border-gray-700 bg-gray-950" />
    <label for="admin-confirm" class="text-sm text-gray-300">Confirmar contraseña</label>
    <input id="admin-confirm" type="password" name="confirm_password" required oninput="this.setCustomValidity(this.value!==this.form.querySelector('[name=new_password]').value?'Las contraseñas no coinciden':'')" class="px-3 py-2 rounded-md border border-gray-700 bg-gray-950" />
    <button type="submit" class="px-3 py-2 rounded-md bg-primary text-primary-foreground">Guardar</button>
  </form>
  {% endif %}
</div>
{% endblock %}
<script>
(function(){document.body.addEventListener('htmx:afterOnLoad',function(evt){try{var xhr=evt.detail.xhr;var txt=xhr&&xhr.responseText||'';var j=null;try{j=JSON.parse(txt)}catch(_){j=null}if(j&&j.ok){var c=document.getElementById('toast-container');if(!c){var d=document.createElement('div');d.id='toast-container';d.setAttribute('style','display:grid;gap:8px;position:fixed;top:16px;right:16px');document.body.appendChild(d);c=d}var el=document.createElement('div');el.setAttribute('style','background:#16a34a;color:#fff;padding:10px 12px;border-radius:8px;box-shadow:0 10px 15px rgba(0,0,0,0.2)');el.textContent='Guardado';c.appendChild(el);setTimeout(function(){if(el&&el.parentNode){el.parentNode.removeChild(el)}},3000)} else {var c2=document.getElementById('toast-container');if(!c2){var d2=document.createElement('div');d2.id='toast-container';d2.setAttribute('style','display:grid;gap:8px;position:fixed;top:16px;right:16px');document.body.appendChild(d2);c2=d2}var el2=document.createElement('div');el2.setAttribute('style','background:#ef4444;color:#fff;padding:10px 12px;border-radius:8px;box-shadow:0 10px 15px rgba(0,0,0,0.2)');el2.textContent='Error';c2.appendChild(el2);setTimeout(function(){if(el2&&el2.parentNode){el2.parentNode.removeChild(el2)}},3000)}}catch(_){}})})();
</script>