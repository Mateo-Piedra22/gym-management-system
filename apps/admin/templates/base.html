<!DOCTYPE html>
<html lang="es" class="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GymMS Admin</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>tailwind.config = { darkMode: 'class', theme: { extend: { colors: { primary: '#7c3aed', 'primary-foreground': '#ffffff' } } } }</script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/htmx.org@1.9.12" integrity="sha384-ujb1lZYygJmzgSwoxRggbCHcjc0rB2XoQrxeTUQyRjrOnlCoYta87iKBWq3EsdM2" crossorigin="anonymous"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://unpkg.com/flowbite@2.3.0/dist/flowbite.min.js"></script>
  <style>
    .skeleton { position: relative; overflow: hidden; background-color: rgb(31 41 55); }
    .skeleton::after { content: ""; position: absolute; inset: 0; transform: translateX(-100%); background-image: linear-gradient(90deg, rgba(31,41,55,0) 0, rgba(107,114,128,.15) 50%, rgba(31,41,55,0) 100%); animation: shimmer 1.5s infinite; }
    @keyframes shimmer { 100% { transform: translateX(100%) } }
    .htmx-indicator { display: none }
    .htmx-indicator.htmx-request { display: block }
  </style>
</head>
<body class="bg-gray-950 text-gray-100 min-h-screen" x-data="{ open: {{ 'false' if hide_sidebar else 'true' }}, isMobile: window.innerWidth < 768 }" x-init="(() => { const onResize = () => { isMobile = window.innerWidth < 768; if (!isMobile) { open = true } }; window.addEventListener('resize', onResize); onResize(); })()" hx-boost="true" hx-target="#main" hx-select="main > *" hx-push-url="true" hx-indicator="#main-indicator">
  <div x-bind:class="(isMobile ? 'grid grid-cols-1' : (open ? 'grid grid-cols-[240px,1fr]' : 'grid grid-cols-1')) + ' min-h-screen'" class="min-h-screen">
    {% if not hide_sidebar %}
    {% include "sidebar.html" %}
    <div x-show="open && isMobile" class="fixed inset-0 bg-black/60 z-40" x-on:click="open=false"></div>
    {% endif %}
    <main id="main" hx-history-elt class="p-5 w-full min-w-0">
      {% if not hide_sidebar %}
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center gap-2">
          <button id="sidebar-toggle" class="px-3 py-2 rounded-md bg-gray-900" x-on:click="open = !open"><i class="fa-solid fa-bars"></i><span class="ml-2">Menú</span></button>
          <button id="global-open-k" class="px-3 py-2 rounded-md bg-gray-900"><i class="fa-solid fa-magnifying-glass"></i><span class="ml-2">Buscar</span></button>
        </div>
        <div class="flex items-center gap-2">
          <a href="/admin/login" class="px-3 py-2 rounded-md bg-gray-900"><i class="fa-solid fa-right-to-bracket"></i><span class="ml-2">Cambiar cuenta</span></a>
          <form method="post" action="/admin/sessions/invalidate" class="inline"><button type="submit" class="px-3 py-2 rounded-md bg-red-600 text-white"><i class="fa-solid fa-ban"></i><span class="ml-2">Invalidar sesiones</span></button></form>
          <button id="toggle-dark" class="px-3 py-2 rounded-md bg-gray-900"><i class="fa-solid fa-moon"></i></button>
        </div>
      </div>
      {% endif %}
      {% macro btn(label, variant='default', href=None, attrs='', icon=None) %}
        {% set cls = 'px-3 py-2 rounded-md bg-gray-900' %}
        {% if variant=='primary' %}{% set cls = 'px-3 py-2 rounded-md bg-primary text-primary-foreground' %}{% endif %}
        {% if variant=='danger' %}{% set cls = 'px-3 py-2 rounded-md bg-red-600 text-white' %}{% endif %}
        {% if variant=='success' %}{% set cls = 'px-3 py-2 rounded-md bg-green-600 text-white' %}{% endif %}
        {% if variant=='warning' %}{% set cls = 'px-3 py-2 rounded-md bg-yellow-500 text-black' %}{% endif %}
        {% if href %}
          <a href="{{ href }}" class="{{ cls }}" {{ attrs|safe }}>
            {% if icon %}<i class="{{ icon }}"></i><span class="ml-2">{{ label }}</span>{% else %}{{ label }}{% endif %}
          </a>
        {% else %}
          <button class="{{ cls }}" {{ attrs|safe }}>
            {% if icon %}<i class="{{ icon }}"></i><span class="ml-2">{{ label }}</span>{% else %}{{ label }}{% endif %}
          </button>
        {% endif %}
      {% endmacro %}
      {% macro status_badge(status) %}
        {% set st = (status or '') %}
        {% set cls = 'px-2 py-1 rounded-full text-xs bg-gray-700 text-white' %}
        {% if st=='active' %}{% set cls = 'px-2 py-1 rounded-full text-xs bg-green-600 text-white' %}{% endif %}
        {% if st=='suspended' %}{% set cls = 'px-2 py-1 rounded-full text-xs bg-red-600 text-white' %}{% endif %}
        {% if st=='maintenance' %}{% set cls = 'px-2 py-1 rounded-full text-xs bg-yellow-500 text-black' %}{% endif %}
        {% if st=='paid' %}{% set cls = 'px-2 py-1 rounded-full text-xs bg-green-600 text-white' %}{% endif %}
        {% if st=='pending' %}{% set cls = 'px-2 py-1 rounded-full text-xs bg-yellow-500 text-black' %}{% endif %}
        {% if st=='failed' %}{% set cls = 'px-2 py-1 rounded-full text-xs bg-red-600 text-white' %}{% endif %}
        <span class="{{ cls }}">{{ status }}</span>
      {% endmacro %}
      {% block content %}{% endblock %}
    </main>
  </div>
  <div id="main-indicator" class="htmx-indicator fixed top-4 right-4 z-50 hidden">
    <div class="flex items-center gap-2 px-3 py-2 rounded-md bg-gray-900 border border-gray-800 shadow">
      <div class="w-4 h-4 rounded-full border-2 border-gray-500 border-t-transparent animate-spin"></div>
      <span class="text-sm">Cargando...</span>
    </div>
  </div>
  <div id="busy-overlay" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/60" tabindex="-1">
    <div class="p-4 w-[92%] max-w-md bg-gray-900 border border-gray-800 rounded-xl">
      <div class="flex items-center gap-3">
        <div class="w-5 h-5 rounded-full border-2 border-gray-500 border-t-transparent animate-spin"></div>
        <div id="busy-message" class="text-sm">Procesando...</div>
      </div>
    </div>
  </div>
  <div id="global-k-overlay" class="fixed inset-0 bg-black/60 hidden items-center justify-center z-50" tabindex="-1">
    <div class="w-[92%] max-w-[720px] bg-gray-900 border border-gray-800 rounded-xl">
      <div class="p-3 border-b border-gray-800 flex justify-between items-center">
        <div class="font-semibold">Búsqueda</div>
        <button id="global-k-close" class="px-2 py-1 rounded-md bg-gray-800">Cerrar</button>
      </div>
      <div class="p-3">
        <input id="global-k-input" placeholder="Buscar gimnasios o templates" class="px-3 py-2 rounded-md border border-gray-700 bg-gray-950 w-full" />
        <div id="global-k-results" class="mt-3 grid gap-2"></div>
      </div>
    </div>
  </div>
  <div id="global-confirm-overlay" role="dialog" aria-modal="true" aria-labelledby="global-confirm-title" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/60" tabindex="-1">
    <div class="relative p-4 w-full max-w-md">
      <div class="relative bg-gray-900 rounded-lg border border-gray-800 shadow">
        <div class="flex items-center justify-between p-3 border-b border-gray-800">
          <h3 id="global-confirm-title" class="text-base font-semibold text-white">Confirmar acción</h3>
          <button id="global-confirm-cancel" class="px-2 py-1 rounded-md bg-gray-800">Cerrar</button>
        </div>
        <div class="p-3">
          <p id="global-confirm-message" class="text-gray-300">¿Confirmar?</p>
        </div>
        <div class="p-3 flex justify-end gap-2">
          <button id="global-confirm-cancel-2" class="px-2 py-1 rounded-md bg-gray-800">Cancelar</button>
          <button id="global-confirm-yes" class="px-2 py-1 rounded-md bg-primary text-primary-foreground">Confirmar</button>
        </div>
      </div>
    </div>
  </div>
  {% include "scripts.html" %}
  <script>
  (function(){
    try{
      var _orig=HTMLInputElement.prototype.checkValidity;
      if(typeof _orig==='function'){
        HTMLInputElement.prototype.checkValidity=function(){try{return _orig.call(this)}catch(e){return true}};
      }
    }catch(_){}
  })();
  </script>
</body>
</html>